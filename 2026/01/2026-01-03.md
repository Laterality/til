# 2026-01-03

## Envoy

### 아키텍처 개요

#### 고급

##### 동적 모듈

> [!WARNING]
>
> 동적 모듈은 활발히 개발중인 기능이다. 시간이 지나면서 기능은 늘어났지만 여전히 다른 확장 메커니즘에서 사용 가능한 기능들이 누락돼 있다. 기능을 향상시키기 위해 커뮤니티로부터 피드백을 받고 있다.

Envoy는 런타임에 공유 라이브러리를 로딩하는 것을 지원해 기능을 확장한다. Envoy에서 이는 "동적 모듈"로 알려져 있다. 더 구체적으로, 동적 모듈은 순수 C 헤더 파일로 작성된 [ABI][envoy-dynamic-modules-abi-h]를 구현하는 공유 라이브러리다. ABI는 동적 모듈이 Envoy에 로드되기 위해 구현해야 하는 기능 집합을 정의한다. 또한 동적 모듈이 Envoy와 상호작용하기 위해 호출할 수 있는 Envoy가 구현한 함수들을 명시한다.

ABI를 처음부터(from scratch)구현하는 것은 Envoy 내부에 대한 광범위한 이해를 필요로 한다. 사용자들을 위해 이러한 세부사항을 추상화하고 동적 모듈을 구현하는 고수준 API를 제공하는 공식 SDK를 제공한다. SDK는 Rust로 사용 가능하다. 이론적으로 공유 라이브러리를 만들 수 있는 어떤 언어든 동적 모듈 구혆에 사용할 수 있다. 추후 다른 언어에 대한 지원이 개발에 포함될 수 있다.

현재, 동적 모듈은 다음 확장 지점에서 지원된다:

- [리스너 필터][api-extensions-filters-dynamic-module-listener-filter]
- [네트워크 필터][api-extensions-filter-dynamic-module-network-filter]
- [HTTP 필터][api-extensions-filters-dynamic-module-filter]

동적 모듈에 대한 몇 가지 설계 목표가 있다:

1. **성능**: 동적 모듈은 내장 C++ 확장들과 비교해 최소한의 오버헤드를 가져야 한다. 예를 들어, 동적 모듈은 다른 확장 메커니즘들과 달리 HTTP 헤더뿐만 아니라 본문에도 복사 없이 접근할 수 있다.
2. **사용 용이성**: SDK는 Envoy 내부의 상세 정보를 추상화하는 고수준 API를 제공한다.
3. **유연성**: 동적 모듈은 성능 손실 없이 내장 C++ 확장에서 구현될 수 있는 어떤 기능이든 구현할 수 있어야 한다. 이는 진행중이며 많은 기능들을 아직 사용할 수 없다.

[envoy-dynamic-modules-abi-h]: https://github.com/envoyproxy/envoy/blob/d7b83e1e18dc741af3b27f1c6c0b786898b23dab/source/extensions/dynamic_modules/abi.h
[api-extensions-filters-dynamic-module-listener-filter]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/listener/dynamic_modules/v3/dynamic_modules.proto#envoy-v3-api-msg-extensions-filters-listener-dynamic-modules-v3-dynamicmodulelistenerfilter
[api-extensions-filter-dynamic-module-network-filter]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/dynamic_modules/v3/dynamic_modules.proto#envoy-v3-api-msg-extensions-filters-network-dynamic-modules-v3-dynamicmodulenetworkfilter
[api-extensions-filters-dynamic-module-filter]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/dynamic_modules/v3/dynamic_modules.proto#envoy-v3-api-msg-extensions-filters-http-dynamic-modules-v3-dynamicmodulefilter
