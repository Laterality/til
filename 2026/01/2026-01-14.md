# 2026-01-14

## Envoy

### 요청의 생명주기

#### 요청 흐름

##### 1. 리스너 TCP 수락

`ListenerManager`는 [리스너][arch-listeners-listeners]를 나타내는 구성을 받아 여러 개의 `Listener` 인스턴스를 자신의 각 IP/포트에 바인딩할 책임을 갖는다. 리스너는 다음 세 상태 중 하나일 수 있다:

- *Warming*: 리스너가 구성 의존성(e.g. 라우트 구성, 동적 시크릿)을 대기하고 있다. 이 리스너는 아직 TCP 커넥션을 수락할 준비가 돼 있지 않다.
- *Active*: 리스너가 IP/포트에 바인딩되고 TCP 커넥션을 수락한다.
- *Draining*: 리스너가 더이상 새로운 TCP 커넥션을 수락하지 않지만 드레인 기간 동안 기존 TCP 커넥션은 계속 사용할 수 있다.

각 [워커 스레드][arch-threading-model]는 구성된 리스너마다 고유한 *Listener* 인스턴스를 유지한다. 각 리스너는 SO_REUSEPORT를 통해 같은 포트에 파인딩되거나 이 포트에 바인딩된 소켓 하나를 공유할 수 있다. 새 TCP 커넥션이 도착하면 커널은 어느 워커 스레드가 이 커넥션을 수락할지 결정하고 이 워커 스레드의 *Listener* `Server::ConnectionHandlerImpl::ActiveTcpListener::onAccept()` 콜백이 호출된다.

[arch-listeners-listeners]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/listeners/listeners#arch-overview-listeners
[arch-threading-model]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/intro/threading_model#arch-overview-threading
