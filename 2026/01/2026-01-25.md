# 2026-01-25

## Envoy

### 요청의 생명주기

#### 요청 흐름

##### 11. 요청 후 처리

요청을 완료하면 스트림은 소멸된다. 또한 다음 작업을 수행한다:

- 요청 후 [통계][arch-observability-statistics](e.g. 타이밍, 활성 요청, 업그레이드, 헬스 체크)가 갱신된다. 하지만 일부 통계는 더 일찍 요청 처리 도중에 갱신된다. 통계는 이 시점에 [싱크][api-bootstrap-bootstrap-stats-sink]에 기록되지 않고 배치(batch)된 뒤 일정 주기로 메인 스레드에서 기록한다. 우리 예시에서 이는 statsd 싱크다.
- 액세스 로그 [싱크][arch-observability-access-logging-access-sinks]에 [액세스 로그][arch-observability-access-logging]를 기록한다. 우리 예시에서 이는 파일 액세스 로그다.
- [트레이스][arch-observability-tracing] 스팬이 마무리된다. 우리 예시에서 요청은 요청 헤더를 처리할 때 요청 기간과 상세 정보를 기술하는 트레이스 스팬이 HCM에 의해 생성돼 추적되고 요청 후 처리에서 HCM에 의해 마무리된다.

[arch-observability-statistics]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/statistics#arch-overview-statistics
[api-bootstrap-bootstrap-stats-sink]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/bootstrap/v3/bootstrap.proto#envoy-v3-api-field-config-bootstrap-v3-bootstrap-stats-sinks
[arch-observability-access-logging-access-sinks]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/access_logging#arch-overview-access-logs-sinks
[arch-observability-access-logging]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/access_logging#arch-overview-access-logs
[arch-observability-tracing]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/tracing#arch-overview-tracing
