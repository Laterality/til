# 2025-07-29

## Envoy

### 아키텍처 개요

#### 업스트림 클러스터

##### 헬스 체크

###### 헬스 체크 이벤트 로깅

선택사항으로 [HealthCheck 구성 event_log_path][api-clusters-health-check-health-check-event-log-path]에 로그 파일 경로를 지정해 헬스체커 별 추가(addition)/제거(ejection) 이벤트를 로깅할 수 있다. 로그는 [HealthCheckEvent 메시지][api-envoy-data-core-data-health-check-event]의 JSON 덤프로 구조화된다.

참고: [HealthCheck config event_log_path][api-clusters-health-check-health-check-event-log-path]는 [HealthCheck event_logger 확장][api-clusters-health-check-health-check-event-logger]으로 인해 사용하지 않는다. [event_log_path][api-extensions-health-check-event-sinks-health-check-log-file-sink]는 파일 싱크 확장에서 JSON 덤프에 쓰인다.

새 이벤트 싱크 확장 카탈로그 *envoy.health_check.event_sinks*가 만들어졌으며 API는 [이곳][api-extensions-health-check-event-sinks]에서 확인할 수 있다.

Envoy는 [always_log_health_check_failures 플래그][api-clusters-health-check-health-check-always-log-health-check-failures]를 true로 설정해 모든 헬스 체크 실패를 로깅하도록 구성할 수 있다.

[api-clusters-health-check-health-check-event-log-path]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/health_check.proto#envoy-v3-api-field-config-core-v3-healthcheck-event-log-path
[api-envoy-data-core-data-health-check-event]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/data/core/v3/health_check_event.proto#envoy-v3-api-msg-data-core-v3-healthcheckevent
[api-clusters-health-check-health-check-event-logger]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/health_check.proto#envoy-v3-api-field-config-core-v3-healthcheck-event-logger
[api-extensions-health-check-event-sinks-health-check-log-file-sink]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/health_check/event_sinks/file/v3/file.proto#envoy-v3-api-field-extensions-health-check-event-sinks-file-v3-healthcheckeventfilesink-event-log-path
[api-extensions-health-check-event-sinks]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/health_check_event_sinks/health_check_event_sinks#api-v3-health-check-event-sinks
[api-clusters-health-check-health-check-always-log-health-check-failures]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/health_check.proto#envoy-v3-api-field-config-core-v3-healthcheck-always-log-health-check-failures