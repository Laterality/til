# 2025-11-24

## Envoy

### 아키텍처 개요

#### 기타 기능

##### IP 투명성

###### 원본 소스 HTTP 필터

통제된 배포에서는 [원본 소스 HTTP 필터][http-http-filters-original-source]를 사용해 업스트림 커넥션에 다운스트림 원격 주소를 복제하는 것이 가능할 수 있다. 이 필터는 [원본 소스 리스너 필터][arch-other-features-ip-transparency-original-source-listener-filter]와 비슷하게 동작한다. 주된 차이점은 서로 다른 소스 주소들로부터 단일 다운스트림 커넥션이 여러 HTTP 요청을 실어나르는 경우 중요한 HTTP 헤더에서 원본 소스 주소를 추론할 수 있다는 점이다. 사이드카 프록시로 포워딩하는 프론트 프록시 배포가 한 예이다.

이 필터는 어떤 업스트림 HTTP 호스트와도 동작한다. 하지만 꽤 복잡한 구성이 필요하며 라우팅 제약사항으로 인해 모든 배포에서 지원되지 않을 수 있다.

원본 소스 필터의 몇 가지 단점:

- Envoy가 [x-forwarded-for][config-http-http-connection-manager-http-header-manipulation-x-forwarded-for] 헤더로부터 다운스트림 원격 주소를 추출하도록 적절히 구성돼야 한다.
- 구성이 상대적으로 복잡하다.
- 커넥션 풀링의 제한으로 약간의 성능 손실이 발생할 수 있다.

> [!NOTE]
>
> 이 기능은 Windows에서 지원되지 않는다.

[http-http-filters-original-source]: https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/original_src_filter#config-http-filters-original-src
[arch-other-features-ip-transparency-original-source-listener-filter]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/other_features/ip_transparency#arch-overview-ip-transparency-original-src-listener
[config-http-http-connection-manager-http-header-manipulation-x-forwarded-for]: https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/headers#config-http-conn-man-headers-x-forwarded-for
