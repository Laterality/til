# 2025-11-20

## Envoy

### 아키텍처 개요

#### 기타 기능

##### IP 투명성

###### IP 투명성이란?

프록시로서 Envoy는 IP엔드포인트다. 다운스트림 요청들과는 구분되는 고유한 IP 주소를 갖는다. 결과적으로 Envoy가 업스트림 호스트와 커넥션을 맺을 커넥션의 IP 주소는 프록시된 커넥션과는 다를 것이다.

때로는 업스트림 서버나 네트워크가 많은 이유로 *다운스트림 원격 주소*라 불리는 커넥션의 원본 IP 주소를 알아야 할 때가 있다. 일부 예시:

- IP 주소가 신원(identity)의 일부로 쓰이는 경우.
- IP 주소가 네트워크 정책을 적용하는 데 쓰이거나
- IP 주소가 감사(audit)에 포함되는 경우.

Envoy는 다운스트림 원격 주소를 업스트림 호스트에 제공하는 여러 방법을 지원한다. 이 기법들은 복잡도와 적용성에 따라 다양하다.

Envoy는 원본 IP 주소를 감지하는 [확장][api-extensions-filters-http-connection-manager-original-ip-detection-extensions]도 지원한다. 적용 가능한 기법에 없을 때 유용할 수 있다. 사용 가능한 두 가지 확장은 [커스텀 헤더][api-extensions-http-original-ip-detection] 확장과 [xff][api-extensions-http-original-ip-detection-xff-config] 확장이다.

[api-extensions-filters-http-connection-manager-original-ip-detection-extensions]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-original-ip-detection-extensions
[api-extensions-http-original-ip-detection]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/http/original_ip_detection/custom_header/v3/custom_header.proto#envoy-v3-api-msg-extensions-http-original-ip-detection-custom-header-v3-customheaderconfig
[api-extensions-http-original-ip-detection-xff-config]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/http/original_ip_detection/xff/v3/xff.proto#envoy-v3-api-msg-extensions-http-original-ip-detection-xff-v3-xffconfig
