# 2025-11-13

## Envoy

### 아키텍처 개요

#### 운영 및 구성

##### 과부하 관리자

###### 아키텍처

과부하 관리자는 주기적으로 **리소스** 집합의 *압력*을 폴링해 **트리거**에 먹이고(feed) 트리거에 따라 **액션**을 수행해 동작한다. 모니터할 리소스 집합, 트리거, 액션은 시작 시점에 지정된다.

**리소스**

리소스는 과부하 관리자에 의해 모니터링될 수 있고 *압력*은 [0, 1] 범위의 실수로 표현된다. 리소스의 압력은 *리소스 모니터*에 의해 평가된다. 리소스 모니터를 설정하는 방법은 [구성 페이지][config-operations-overload-manager]를 참고하라.

**트리거**

트리거는 매 리소스 압력 갱신마다 평가되며 리소스 압력 값을 액션 상태로 변환한다. 액션 상태는 [0, 1] 범위의 실수를 가지며 두 그룹으로 나뉜다:

| 액션 상태 | 값     | 설명                                                                                      |
| --------- | ------ | ----------------------------------------------------------------------------------------- |
| scaling   | [0, 1) | 리소스 압력이 구성된 포화점보다 낮다. 액션이 수행될 수 있다.                              |
| saturated | 1      | 리소스 압력이 구성된 포화점과 같거나 이를 초과한다. 격렬한(drastic) 액션이 수행돼야 한다. |

리소스 압력 값이 갱신되면 연관된 트리거가 재평가된다. 적어도 하나의 트리거가 있는 각 액션마다 결과 액션 상태는 구성된 트리거에 대한 최댓값이다. 액션 상태에 영향을 주는 것은 액션의 구성과 구현에 따라 다르다.

**액션**

트리거가 상태를 바꾸면 등록된 액션으로 값이 보내져 이후 커넥션과 요청이 처리되는 방식에 영향을 줄 수 있다. 각 액션은 입력 상태를 다르게 해석하며 *scaling* 상태는 무시하고 *saturated* 상태일 때만 효과를 낼 수도 있다.

[append_local_overload][api-extensions-filters-http-connection-manager-append-local-overload]가 true로 설정되면 HTTP 요청 드롭은 커넥션 관리자가 보내는 로컬 응답에 [x-envoy-overloaded][config-http-http-connection-manager-http-header-manipulation] 헤더가 설정되게 만들 수 있다.

[config-operations-overload-manager]: https://www.envoyproxy.io/docs/envoy/latest/configuration/operations/overload_manager/overload_manager#config-overload-manager
[api-extensions-filters-http-connection-manager-append-local-overload]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-append-local-overload
[config-http-http-connection-manager-http-header-manipulation]: https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/headers#config-http-conn-man-headers-x-envoy-local-overloaded
