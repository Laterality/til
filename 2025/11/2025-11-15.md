# 2025-11-15

## Envoy

### 아키텍처 개요

#### 기타 기능

##### 전역 요청량 제한

분산 시스템에서 처리량을 제어하는 데에는 분산 [서킷 브레이킹][arch-upstream-circuit-breaking]이 일반적으로 매우 효율적이지만 때로는 매우 효율적이지 않고 전역 요청량 제한이 적합할 때가 있다. 가장 흔한 사례는 다수의 호스트가 소수의 호스트로 요청을 포워딩하고 요청 지연이 낮은 경우다(e.g. 데이터베이스 서버에 대한 요청/커넥션). 대상 호스트가 백업이 되면 다운스트림 호스트는 업스트림 클러스터를 압도하게 된다. 이 시나리오에서는 일반적인 요청 패턴 도중에 시스템이 정상적으로 동작하면서도 시스템이 실패하기 시작하면 실패가 전파되지 않도록 각 다운스트림 호스트에 서킷 브레이킹을 충분히 타이트하게 구성하는 것이 매우 어렵다. 전역 요청량 제한은 이러한 경우에 좋은 해결책이다.

Envoy는 두 전역 요청량 제한 구현을 제공한다:

1. 커넥션 별 또는 HTTP 요청 별 요청량 제한 검사.
2. 쿼터(Quota) 기반 여러 Envoy 인스턴스 사이에서 전역 요청량 제한의 공평하게 나눈 비율만큼 허용하도록 주기적으로 부하를 보고한다. 이 구현은 모든 Envoy 인스턴스 사이에 균형이 맞지 않을 수 있는 초당 요청량이 많은 대규모 Envoy 배포에 적합하다.

[arch-upstream-circuit-breaking]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/circuit_breaking#arch-overview-circuit-break
