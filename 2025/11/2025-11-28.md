# 2025-11-28

## Envoy

### 아키텍처 개요

#### 기타 프로토콜

##### gRPC

###### gRPC 서비스

데이터 플레인에서 gRPC를 프록시하는 것 외에도 Envoy는 컨트롤 플레인에서 [요청량 제한][config-http-http-filters-rate-limit]이나 인가 검사 등을 [관리 서버로부터 구성을 인출][config-overview]하고 필터링하는 데에 gRPC를 사용한다. 이를 *gRPC 서비스*라 부른다.

gRPC 서비스를 지정할 때는 [Envoy gRPC 클라이언트][api-common-grpc-services-grpc-service-envoy-grpc] 또는 [Google C++ gRPC 클라이언트][api-common-grpc-services-grpc-service-google-grpc] 중 하나를 사용하도록 명시해야 한다. 아래에서 이 선택의 트레이드오프에 대해 다룬다.

Envoy gRPC 클라이언트는 Envoy의 HTTP/2 또는 HTTP/3 업스트림 커넥션 관리를 사용하는 최소한의 커스텀 gRPC 구현체다. 서비스는 [타임아웃, 재시도][arch-http-http-connection-management], 엔드포인트 [디스커버리][arch-operations-configuration-xds-configuration-api-overview-eds]/[로드 밸런싱/페일오버][arch-upstream-clusters-load-balancing]/부하 보고, [서킷 브레이킹][arch-upstream-clusters-circuit-breaking], [헬스 체크][arch-upstream-clusters-health-checking], [아웃라이어 감지][arch-upstream-clusters-outliter-detection]와 함께 정규 Envoy [클러스터][arch-upstream-clusters-cluster-manager]로 지정된다. 이들은 Envoy 데이터 플레인처럼 같은 [커넥션 풀링][arch-upstream-clusters-connection-pooling] 메커니즘을 공유한다. 비슷하게, gRPC 서비스에 대한 클러스터 [통계][arch-observability-statistics]를 사용할 수 있다. 클라이언트는 최소한의 구현이기 때문에 [OAuth2][oauth2]나 [gRPC-LB][grpc-load-balancing] 조회와 같은 고급 gRPC 기능은 포함돼 있지 않다.

Google C++ gRPC 클라이언트는 https://github.com/grpc/grpc 에서 Google이 제공하는 레퍼런스 구현체를 기반으로 한다. Envoy gRPC 클라ㄹ이언트에는 없는 고급 gRPC 기능을 제공한다. Google C++ gRPC 클라이언트는 Envoy의 클러스터 관리와 독립적으로 고유한 로드 밸런싱, 재시도, 타임아웃, 엔드포인트 관리 등을  수행한다. Google C++ gRPC 클라이언트는 [커스텀 인증 플러그인][grpc-guides-authentication]도 지원한다.

Google C++ gRPC 클라이언트의 고급 기능들이 필요하지 않은 대부분의 경우에는 Envoy gRPC 클라이언트를 사용하는 것을 권장한다. 이는 구성과 모니터링 단순성을 제공한다. Envoy gRPC 클라이언트에는 없는 기능이 필요한 곳에는 Google C++ gRPC 클라이언트를 사용해야 한다.

[config-http-http-filters-rate-limit]: https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/rate_limit_filter#config-http-filters-rate-limit
[config-overview]: https://www.envoyproxy.io/docs/envoy/latest/configuration/overview/overview#config-overview
[api-common-grpc-services-grpc-service-envoy-grpc]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/grpc_service.proto#envoy-v3-api-field-config-core-v3-grpcservice-envoy-grpc
[api-common-grpc-services-grpc-service-google-grpc]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/grpc_service.proto#envoy-v3-api-field-config-core-v3-grpcservice-google-grpc 
[arch-upstream-clusters-cluster-manager]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/cluster_manager#arch-overview-cluster-manager 
[arch-http-http-connection-management]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_connection_management#arch-overview-http-conn-man
[arch-operations-configuration-xds-configuration-api-overview-eds]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration#arch-overview-dynamic-config-eds
[arch-upstream-clusters-load-balancing]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/overview#arch-overview-load-balancing
[arch-upstream-clusters-circuit-breaking]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/circuit_breaking#arch-overview-circuit-break
[arch-upstream-clusters-health-checking]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/health_checking#arch-overview-health-checking
[arch-upstream-clusters-outliter-detection]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/outlier#arch-overview-outlier-detection
[arch-upstream-clusters-connection-pooling]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/connection_pooling#arch-overview-conn-pool
[arch-observability-statistics]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/statistics#arch-overview-statistics
[oauth2]: https://oauth.net/2/
[grpc-load-balancing]: https://grpc.io/blog/grpc-load-balancing/
[grpc-guides-authentication]: https://grpc.io/docs/guides/auth/#extending-grpc-to-support-other-authentication-mechanisms
