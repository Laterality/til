# 2025-11-16

## Envoy

### 아키텍처 개요

#### 기타 기능

##### 전역 요청량 제한

###### 커넥션 별 또는 HTTP 요청 별 요청량 제한

Envoy는 전역 gRPC 요청량 제한 서비스와 직접 통합한다. 정의된 RPC/IDL 프로토콜을 구현하는 어떤 서비스든 사용될 수 있지만 Envoy는 Redis 백엔드를 사용하는 Go로 작성된 [레퍼런스 구현][envoyproxy-ratelimit]을 제공한다. Envoy의 요청량 제한 통합은 다음 기능을 가지고 있다:

* **네트워크 수준 요청량 제한 필터**: Envoy는 필터가 설치된 리스너에 새 커넥션마다 요청량 제한 서비스를 호출한다. 구성은 특정 도메인과 설명자를 명시해 요청량을 제한한다. 이는 궁극적으로 리스너를 통과하는 초당 커넥션을 제한하는 효과가 있다. [구성 레퍼런스][config-listeners-network-filters-rate-limit].
* **HTTP 수준 요청량 제한 필터**: Envoy는 필터가 설치된 리스너와 전역 요청량 제한 서비스가 호출돼야 한다고 명시한 라우트 테이블의 새 요청마다 요청량 제한 서비스를 호출한다. 대상 업스트림리 클러스터로의 모든 요청뿐만아니라 원본 클러스터에서 대상 클러스터로의 모든 요청도 제한할 수 있다. [구성 레퍼런스][config-http-filters-rate-limit]

요청량 제한 서비스 [구성][config-other-features-rate-limit-service].

Envoy는 [로컬 요청량 제한][config-listeners-network-filters-local-rate-limit]도 지원한다. 로컬 요청량 제한은 전역 요청량 제한 서비스와 조합해 전역 요청량 제한 서비스의 부하를 줄일 수 있다. 예를 들어, 로컬 토큰 버킷 요청량 제한이 전역 요청량 제한 서비스에 영향을 줄 수 있는 대량의 버스트를 흡수할 수 있다. 따라서, 요청량 제한 서비스는 두 단계로 적용된다. 세밀하게 나눠진 전역 제한이 수행되기 전에 토큰 버킷 제한에 의해 예비 제한이 수행된다.

[envoyproxy-ratelimit]: https://github.com/envoyproxy/ratelimit
[config-listeners-network-filters-rate-limit]: https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/network_filters/rate_limit_filter#config-network-filters-rate-limit
[config-http-filters-rate-limit]: https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/rate_limit_filter#config-http-filters-rate-limit
[config-other-features-rate-limit-service]: https://www.envoyproxy.io/docs/envoy/latest/configuration/other_features/rate_limit#config-rate-limit-service
[config-listeners-network-filters-local-rate-limit]: https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/network_filters/local_rate_limit_filter#config-network-filters-local-rate-limit
