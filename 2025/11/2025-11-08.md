# 2025-11-08

## Envoy

### 아키텍처 개요

#### 운영 및 구성

##### 초기화

Envoy를 시작할 때 자기 자신을 초기화하는 방법은 복잡하다. 이 섹션은 고수준에서 이 프로세스가 어떻게 동작하는지 설명한다. 아래의 모든 일들이 리스너가 리스닝을 시작하고 새 커넥션을 받기 전에 일어난다.

* 시작 도중에, [클러스터 매니저][arch-upstream-clusters-cluster-manager]가 정적/DNS 클러스터를 먼저 초기화하고 사전 정의된 [EDS][arch-operations-and-configuration-xds-configuration-api-overview-eds] 클러스터를 초기화하는 다단계 초기화를 거친다. 그 다음 적용할 수 있는 경우 [CDS][arch-operations-and-configuration-xds-configuration-api-overview-cds]를 초기화하는데, [지정된 시간][api-common-messages-configuration-sources-config-source-initial-fetch-timeout] 동안 응답(또는 실패) 하나를 기다리고 CDS가 제공한 클러스터에 동일하게 기본/보조 초기화를 수행한다.
* 만약 클러스터가 [능동적 헬스 체크][arch-upstream-clusters-health-checking]를 사용하는 경우, Envoy는 단일 능동적 헬스 체크 라운드를 수행한다.
* 클러스터 매니저 초기화가 끝나면, (적용할 수 있는 경우) [RDS][arch-operations-and-configuration-xds-configuration-api-overview-rds]와 [LDS][arch-operations-and-configuration-xds-configuration-api-overview-lds]를 초기화한다. 서버는 [지정된 시간][api-common-messages-configuration-sources-config-source-initial-fetch-timeout]동안 LDS/RDS 요청에 대한 응답(또는 실패)를 적어도 하나 기다린다. 그 후, 커넥션을 받기 시작한다.
* LDS 자체가 RDS 응답이 필요한 리스너를 반환하면, Envoy는 RDS 응답(또는 실패)를 수신할 때까지 [지정된 시간][api-common-messages-configuration-sources-config-source-initial-fetch-timeout]동안 추가로 기다린다. 이 과정은 LDS를 통해 리스너가 추가될 때마다 발생하며 [리스너 워밍][api-common-messages-configuration-sources-config-source-initial-fetch-timeout]으로 알려져 있다.
* 앞선 작업들이 모두 끝나면 리스너가 새 커넥션을 받기 시작한다. 이 흐름은 핫 리스타트동안 기존 프로세스를 드레인을 시작하기 전에 새 프로세스가 새 커넥션을 받아 처리할 수 있도록 보장한다.

초기화의 핵심 설계 원칙은 관리 서버 가용성의 내의 완전한 xDS 구성 집합을 얻기 위한 최선의 노력과 함께 Envoy가 [initial_fetch_timeout]api-common-messages-configuration-sources-config-source-initial-fetch-timeout] 내에 초기화하도록 보장된다는 것이다.

[arch-upstream-clusters-cluster-manager]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/cluster_manager#arch-overview-cluster-manager
[arch-operations-and-configuration-xds-configuration-api-overview-eds]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration#arch-overview-dynamic-config-eds
[arch-operations-and-configuration-xds-configuration-api-overview-cds]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration#arch-overview-dynamic-config-cds
[api-common-messages-configuration-sources-config-source-initial-fetch-timeout]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/config_source.proto#envoy-v3-api-field-config-core-v3-configsource-initial-fetch-timeout
[arch-upstream-clusters-health-checking]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/health_checking#arch-overview-health-checking
[arch-operations-and-configuration-xds-configuration-api-overview-rds]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration#arch-overview-dynamic-config-rds
[arch-operations-and-configuration-xds-configuration-api-overview-lds]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration#arch-overview-dynamic-config-lds
