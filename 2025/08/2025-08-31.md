# 2025-08-31

## Envoy

### 아키텍처 개요

#### 업스트림 클러스터

##### 로드 밸런싱 - 호스트 오버라이드

로드 밸런싱 알고리즘(라운드 로빈, 랜덤 등)은 기본적으로 업스트림 호스트를 선택하는 데 쓰인다. 또한 Enoy는 유효한 오버라이드 호스트 주소를 명시함으로써 로드 밸런싱 알고리즘의 결과를 오버라이드하는 것을 지원한다. 유효한 오버라이드 호스트 주소가 지정됐고 해당하는 업스트림 호스트가 [예상 헬스 상태][api-clusters-cluster-configuration-common-lb-config-override-host-status]를 가지고 있으면, 이 업스트림 호스트가 우선적으로 선택될 것이다.

예를 들어, [stateful session 필터][config-http-http-filters-stateful-session]는 다운스트림 요청 속성에 따라 호스트 주소를 직접 오버라이드할 것이다. 이후 로드 밸런싱 알고리즘 결과는 무시될 것이다. 이 방법으로 스테이트풀 세션 스티키니스를 구현할 수 있다.

정리하면, 호스트 오버라이드는 업스트림 로드 밸런싱의 최종 결과에 L4/L7 확장이 영향을 미칠 수 있게 하는 메커니즘을 제공한다. 이 메커니즘은 다른 시나리오에서 다른 확장에 의해 쓰일 수도 있다.

[api-clusters-cluster-configuration-common-lb-config-override-host-status]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/cluster/v3/cluster.proto#envoy-v3-api-field-config-cluster-v3-cluster-commonlbconfig-override-host-status
[config-http-http-filters-stateful-session]: https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/stateful_session_filter#config-http-filters-stateful-session