# 2025-08-12

## Envoy

### 아키텍처 개요

#### 업스트림 클러스터

##### 로드밸런싱

###### 전역 로드밸런싱

전역 로드 밸런싱은 하나의 전역적인 기관(authority)이 호스트 사이에 부하를 어떻게 분산시킬지 결정하는 것을 의미한다. Envoy에서는 우선순위, 지역성 가중치, 엔드포인트 가중치와 엔드포인트 헬스와 같은 다양한 파라미터를 명시함으로써 개별 엔드포인트에 적용되는 부하를 조정할 수 있는 컨트롤 플레인을 통해 가능하다.

간단한 예시는 컨트롤 플레인이 더 적은 네트워크 홉을 필요로 하는 호스트를 선호하도록 네트워크 토폴로지에 따라 호스트에 서로 다른 [우선순위][arch-upstream-clusters-load-balancing-priority-levels]를 할당하는 것이다. 이는 존 인식 라우팅과 비슷하지만 Envoy 대신 컨트롤 플레인에서 처리된다. 이를 컨트롤 플레인에서 할 때의 이점은 존 인식 라우팅의 [한계][arch-upstream-clusters-load-balancing-zone-aware-routing] 일부를 해결할 수 있다는 점이다.

더 복잡한 셋업은 컨트롤 플레인에 보고되는 리소스 사용량을 가지고 새 요청을 바쁜 호스트 대신 유휴 호스트로 라우팅을 시도하도록 현재 리소스 사용량을 고려해 엔드포인트의 가중치나 [지역성][arch-upstream-clusters-load-balancing-locality-weighted-load-balancing]을 조정할 수 있게 하는 것이다.

[arch-upstream-clusters-load-balancing-priority-levels]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/priority#arch-overview-load-balancing-priority-levels
[arch-upstream-clusters-load-balancing-zone-aware-routing]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/zone_aware#arch-overview-load-balancing-zone-aware-routing-preconditions
[arch-upstream-clusters-load-balancing-locality-weighted-load-balancing]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/locality_weight#arch-overview-load-balancing-locality-weighted-lb
