# 2025-08-02

## Envoy

### 아키텍처 개요

#### 업스트림 클러스터

##### 헬스 체크

###### 능동적 헬스 체크 빠른 실패

능동적 헬스 체크를 수동적 헬스 체크([아웃라이어 감지][arch-upstream-clusters-outlier-detection])와 함께 사용할 때는 능동적 헬스 체크 트래픽이 많아지는 것을 피하기 위해 헬스 체크 주기를 길게 하는 경우가 많다. 이 경우 [/healthcheck/fail][ops-and-admin-admin-interface-healthcheck-fail] 어드민 엔드포인트를 사용할 때 업스트림 호스트를 빠르게 드레인할 수 있는 것이 여전히 유용하다. 이를 지원하기 위해 [라우터 필터][config-http-http-filters-router]*와* HTTP 능동적 헬스 체커는 [x-envoy-immediate-health-check-fail][config-http-http-filters-router-response-headers-x-envoy-immediate-health-check-fail] 헤더로 응답한다. 업스트림 호스트가 이 헤더를 설정하면 Envoy는 즉시 그 호스트를 능동적 헬스 체크가 실패한 것으로 표시하고 로드 밸런싱에서 [제외][arch-upstream-clusters-load-balancing-excluded-endpoints]한다. 이는 호스트의 클러스터에 능동적 헬스 체크가 [구성][config-upstream-clusters-health-checking]된 경우에만 일어난다. [헬스 체크 필터][config-http-http-filters-health-check]는 Envoy가 [/healthcheck/fail][ops-and-admin-admin-interface-healthcheck-fail] 어드민 엔드포인트를 통해 표시된 경우 자동으로 이 헤더를 설정한다.


[arch-upstream-clusters-outlier-detection]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/outlier#arch-overview-outlier-detection
[ops-and-admin-admin-interface-healthcheck-fail]: https://www.envoyproxy.io/docs/envoy/latest/operations/admin#operations-admin-interface-healthcheck-fail
[config-http-http-filters-router]: https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/router_filter#config-http-filters-router
[config-http-http-filters-router-response-headers-x-envoy-immediate-health-check-fail]: https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/router_filter#config-http-filters-router-x-envoy-immediate-health-check-fail
[arch-upstream-clusters-load-balancing-excluded-endpoints]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/excluded#arch-overview-load-balancing-excluded
[config-upstream-clusters-health-checking]: https://www.envoyproxy.io/docs/envoy/latest/configuration/upstream/cluster_manager/cluster_hc#config-cluster-manager-cluster-hc
[config-http-http-filters-health-check]: https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/health_check_filter#config-http-filters-health-check