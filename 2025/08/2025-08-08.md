# 2025-08-08

## Envoy

### 아키텍처 개요

#### 업스트림 클러스터

##### 커넥션 풀링

###### 커넥션 풀 수

클러스터의 각 호스트는 하나 이상의 커넥션 풀을 갖는다. 클러스터에 하나의 명시적인 프로토콜이 구성됐다면 이 호스트는 하나의 커넥션 풀만 가질 것이다. 하지만 클러스터가 여러 업스트림 프로토콜을 지원하는 경우 ALPN을 사용중이지 않은 한 프로토콜마다 하나의 커넥션 풀이 할당된다. 개별 커넥션 풀은 다음 특징에 따라 각각 할당된다:

* [라우팅 우선순위][arch-http-http-routing-priority-routing]
* [소켓 옵션][api-common-network-addresses-bind-config-socket-options]
* [전송 소켓(e.g. TLS) 옵션][api-common-common-types-transport-socket]
* 해시 가능하고 업스트림 커넥션과 공유되는 것으로 표시된 다운스트림 [필터 상태 객체][arch-advanced-sharing-data-filter-state-sharing]

각 워커 스레드는 클러스터마다 고유한 커넥션 풀을 유지하므로 Envoy가 두 개의 스레드와 HTTP/1과 HTTP/2 양쪽을 지원하는 클러스터를 가지면 최소 4개의 커넥션 풀이 존재할 것이다.

[arch-http-http-routing-priority-routing]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/http/http_routing#arch-overview-http-routing-priority
[api-common-network-addresses-bind-config-socket-options]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/address.proto#envoy-v3-api-field-config-core-v3-bindconfig-socket-options
[api-common-common-types-transport-socket]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/base.proto#envoy-v3-api-msg-config-core-v3-transportsocket
[arch-advanced-sharing-data-filter-state-sharing]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/advanced/data_sharing_between_filters#arch-overview-advanced-filter-state-sharing
