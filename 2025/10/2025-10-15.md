# 2025-10-15

## Envoy

### 아키텍처 개요

#### 보안

##### 외부 인가

* [네트워크 필터 구성][config-listeners-network-filters-external-authorization]
* [HTTP 필터 구성][config-http-http-filters-external-authorization]
  
외부 인가 필터는 인가 서비스를 호출해 인입 요청이 인가됐는지를 확인한다. 필터는 [네트워크 필터][config-listeners-network-filters-external-authorization]나 [HTTP 필터][config-http-http-filters-external-authorization] 중 하나 또는 둘 다로 구성할 수 있다. 요청이 네트워크 필터에 의해 인가되지 않은 것으로 간주되면 커넥션이 닫힌다. 요청이 HTTP 필터에 의해 인가되지 않은 것으로 간주되면 403 (Forbidden) 응답으로 거부된다.

> [!TIP]
>
> 이 필터들을 필터 체인의 첫 번째 필터로 구성해 나머지 필터들이 요청을 처리하기 전에 요청이 인가되도록 하는 것을 권장한다.

외부 인가 서비스 클러스터는 정적으로 구성하거나 [Cluster Discovery Service][config-upstream-clusters-cluster-manager-cluster-discovery-service]를 통해 구성할 수 있다. 요청이 인입됐을 때 외부 서비스를 사용할 수 없는 경우(not available) 요청이 인가되는지 아닌지는 [네트워크 필터][api-extensions-filters-network-filters-network-external-authorization-ext-authz]나 [HTTP 필터][api-extensions-filters-http-filters-external-authorization-ext-authz]에서 적용 가능한 `failure_mode_allow_configuration` 구성 설정에 의해 정의된다. 기본 설정은 `false`이다.

[config-listeners-network-filters-external-authorization]: https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/network_filters/ext_authz_filter#config-network-filters-ext-authz
[config-http-http-filters-external-authorization]: https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/ext_authz_filter#config-http-filters-ext-authz
[config-upstream-clusters-cluster-manager-cluster-discovery-service]: https://www.envoyproxy.io/docs/envoy/latest/configuration/upstream/cluster_manager/cds#config-cluster-manager-cds
[api-extensions-filters-network-filters-network-external-authorization-ext-authz]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/ext_authz/v3/ext_authz.proto#envoy-v3-api-msg-extensions-filters-network-ext-authz-v3-extauthz
[api-extensions-filters-http-filters-external-authorization-ext-authz]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/ext_authz/v3/ext_authz.proto#envoy-v3-api-msg-extensions-filters-http-ext-authz-v3-extauthz
