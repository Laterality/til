# 2025-10-04

## Envoy

### 아키텍처 개요

#### 보안

##### TLS

Envoy는 리스너에서의 [TLS 종료][api-listeners-listener-components-filter-chain-transport-socket]뿐만아니라 업스트림 클러스터로의 커넥션을 만들 때 [TLS 오리지네이션][api-clusters-cluster-configuration-cluster-transport-socket]도 지원한다. 지원은 모던 웹 서비스에서 Envoy가 표준 엣지 프록시 역할을 수행하는데 뿐만아니라 고급 TLS 요구사항(TLS1.2, SNI 등)을 가진 외부 서비스와의 연결을 시작하는 데에도 충분하다. Envoy는 다음의 TLS 기능들을 지원한다:

* **구성 가능한 암호화(cipher)**: 각 TLS 리스너와 클라이언트는 자신이 지원하는 암호화를 지정할 수 있다.
* **클라이언트 인증서**: 업스트림/클라이언트 커넥션은 서버 인증서 검증 외에 클라이언트 인증서를 제시할 수 있다.
* **인증서 검증 및 고정**: 인증서 검증 옵션에는 기본적인 체인 검증, 대상 이름 검증, 해시 고정 등이 포함된다.
* **인증서 회수**: Envoy는 인증서 회수 목록(CRL)이 [제공][api-extensions-transport-sockets-certificate-validation-context-crl]되면 이에 대해 동료(peer) 인증서를 검사할 수 있다.
* **ALPN**: TLS 리스너는 ALPN을 지원한다. HTTP 커넥션 관리자는 (프로토콜 추정 외에)이 정보를 사용해 클라이언트가 HTTP/1.1과 HTTP/2 중 어느 것으로 통신하는지 결정한다.
* **SNI**: 서버(리스너)와 클라이언트(업스트림) 커넥션 양쪽에 대해 SNI가 지원된다.
* **세션 재개**: 서버 커넥션은 TLS 세션 티켓([RFC5077][rfc-5077] 참고)을 통해 이전 세션을 재개하는 것을 지원한다. 재개는 핫 리스타트 사이와 (주로 프론트 프록시 구성에서 유용한)병렬 Envoy 인스턴스 사이에서 수행될 수 있다.
* **BoringSSL 개인 키 방식**: TLS 개인 키 연산(서명과 복호화)는 [확장][api-extensions-transport-sockets-private-key-provider]으로부터 비동기로 수행될 수 있다. 이는 Envoy가 (TPM과 같은)다양한 키 관리 스킴과 TLS 가속을 지원할 수 있게 한다. 이 메커니즘은 [BoringSSL 개인 키 방식 인터페이스][boringssl]를 사용한다.
* **OCSP 고정(stapling)**: 온라인 인증서 스테이플링 프로토콜(Oline Certificate Stapling Protocol) 응답을 인증서에 고정할 수 있다.

[api-listeners-listener-components-filter-chain-transport-socket]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/listener/v3/listener_components.proto#envoy-v3-api-field-config-listener-v3-filterchain-transport-socket
[api-clusters-cluster-configuration-cluster-transport-socket]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/cluster/v3/cluster.proto#envoy-v3-api-field-config-cluster-v3-cluster-transport-socket
[api-extensions-transport-sockets-certificate-validation-context-crl]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/transport_sockets/tls/v3/common.proto#envoy-v3-api-field-extensions-transport-sockets-tls-v3-certificatevalidationcontext-crl
[rfc-5077]: https://www.ietf.org/rfc/rfc5077.txt
[api-extensions-transport-sockets-private-key-provider]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/transport_sockets/tls/v3/common.proto#envoy-v3-api-msg-extensions-transport-sockets-tls-v3-privatekeyprovider
[boringssl]: https://github.com/google/boringssl/blob/c0b4c72b6d4c6f4828a373ec454bd646390017d4/include/openssl/ssl.h#L1169
