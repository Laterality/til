# 2025-10-12

## Envoy

### 아키텍처 개요

#### 보안

##### TLS

###### 커스텀 핸드셰이커 확장

[CommonTlsContext][api-extensions-transport-sockets-common-tls-context-custom-handshaker]는 전체 SSL 핸드셰이크 동작을 오버라이드하는데 사용할 수 있는 `custom_handshaker` 확장을 가지고 있다. 이는 콜백으로 표현하기 어려운 TLS 동작을 구현하는 데 유용하다. 비밀 키 방식에 커스텀 핸드셰이커를 사용해야 할 필요는 없다. [비밀 키 방식 인터페이스][arch-security-tls]를 참고하라.

모든 [Ssl::ConnectionInfo][envoy-ssl-connection] 인터페이스를 재구현하는 것을 피하기 위해 커스텀 구현체는 [Envoy::Extensions::TransportSockets::Tls::SslHandshakerImpl][envoy-extensions-tls-ssl-handshaker-impl]을 확장할 수 있다.

커스텀 핸드셰이커는 [HandshakerCapabilities][envoy-ssl-handshaker-capabilities]를 통해 명시적으로 어떤 TLS 기능에 대한 책임을 갖는지 선언해야 한다. 기본 Envoy 핸드셰이커는 나머지를 관리할 것이다.

`SslHandshakerImplForTest`로 명명된 유용한 핸드셰이커는 [이 테스트][envoy-extensions-ssl-handshaker-impl-for-test]에 있고 특수한 경우의 `SSL_ERROR` 처리와 콜백을 설명한다.

[api-extensions-transport-sockets-common-tls-context-custom-handshaker]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/transport_sockets/tls/v3/tls.proto#envoy-v3-api-field-extensions-transport-sockets-tls-v3-commontlscontext-custom-handshaker
[arch-security-tls]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/security/ssl#arch-overview-ssl
[envoy-ssl-connection]: https://github.com/envoyproxy/envoy/blob/64bd6311bcc8f5b18ce44997ae22ff07ecccfe04/include/envoy/ssl/connection.h#L19
[envoy-extensions-tls-ssl-handshaker-impl]: https://github.com/envoyproxy/envoy/blob/64bd6311bcc8f5b18ce44997ae22ff07ecccfe04/source/extensions/transport_sockets/tls/ssl_handshaker.h#L40
[envoy-ssl-handshaker-capabilities]: https://github.com/envoyproxy/envoy/blob/64bd6311bcc8f5b18ce44997ae22ff07ecccfe04/include/envoy/ssl/handshaker.h#L68-L89
[envoy-extensions-ssl-handshaker-impl-for-test]: https://github.com/envoyproxy/envoy/blob/64bd6311bcc8f5b18ce44997ae22ff07ecccfe04/test/extensions/transport_sockets/tls/handshaker_test.cc#L174-L184
