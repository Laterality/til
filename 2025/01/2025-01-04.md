# 2025. 01. 04.

## OpenID Connect Core 1.0

### 16. 보안 고려사항

#### 16.11. 토큰 대체

토큰 대체는 악의적인 사용자가 공격자가 가진 다른 정당한 사용자의 인가 코드를 포함한 여러 토큰을 교체하는 유형의 공격이다. 공격자가 이를 수행하는 방법 중 하나는 한 세션에서 토큰을 복사한 뒤 다른 세션의  HTTP 메시지에 사용하는 것으로, 브라우저에서 토큰을 볼 수 있으면 간단하다. "잘라서 붙이기"(cut and paste) 공격으로도 알려져 있다.

[OAuth 2.0][rfc-6749]의 묵시적 흐름은 이 위험성을 완화하지 않도록 설계돼 있다. 섹션 10.16에서, 클라이언트에 위임된 최종 사용자가 인증하는 형태의 인가 프로세스를 사용할 때는 클라이언트가 ID Token과 액세스 토큰이 자신이 사용하기 위해 발급된 것인지를 확인할 수 있는 추가적인 보안 메커니즘을 사용하지 않고 묵시적 흐름을 **사용해서는 안된다**.

OpenID Connect에서는 ID Token을 통해 제공되는 메커니즘을 통해 완화한다. ID Token은 `iss`(issuer), `sub`(subject), `aud`(audience), `at_hash`(access token hash), `c_hash`(code hash)와 같은 클레임을 제공하는 서명된 보안 토큰이다. 클라이언트는 ID Token을 사용해 토큰 대체 공격을 탐지할 수 있다.

ID Token의 `c_hash`는 클라이언트가 인가 코드 대체를 방지할 수 있게 한다. ID Token의 `at_hash`는 클라이언트가 액세스 토큰 대체를 방지할 수 있게 한다.

또한, 악의적인 사용자는 인가 엔드포인트와 클라이언트 혹은 토큰 엔드포인트와 클라이언트 사이의 통신 채널을 와해(subvert)시켜 더 많은 권한을 가진 사용자를 가장(impersonate)하려고 시도할 수 있다. 예를 들어, 인가 코드를 바꿔치기하거나 메시지 순서를 재구성해 토큰 엔드포인트에 공격자의 인가 승인이 더 많은 권한을 가진 사용자를 대신해 보내진 승인이라고 속인다.

토큰을 가진 응답과 요청 둘 다 TLS에 의해 보호돼 패킷 순서 재구성 공격을 탐지하고 막을 수 있기 때문에, 이 명세에서 정의된 HTTP 바인딩에 대해, 토큰 요청에 대한 응답은 HTTP에서 메시지 순서에 따라 해당하는 요청에 바인딩된다. 

토큰 엔드포인트 요청과 응답을 강하게 바인딩할 수 없는 프로토콜에 이 명세의 다른 바인딩을 설계할 때는 이 문제를 해결할 수 있는 추가적인 메커니즘을 **활용해야 한다**. 토큰 요청과 응답에 `c_hash` 클레임을 가진 ID Token을 포함시키는 것이 메커니즘의 하나가 될 수 있다.



[rfc-6749]: https://www.rfc-editor.org/rfc/rfc6749.html