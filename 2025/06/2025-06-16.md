# 2025-06-16

## Envoy

### 아키텍처 개요

#### HTTP

##### HTTP 커넥션 관리

###### HTTP 생명주기

요청의 프록시는 다운스트림 HTTP 코덱이 요청 헤더 맵을 성공적으로 디코드하면 시작한다.

프록시가 완료돼 스트림이 소멸하는 시점은 업스트림 프로토콜과 독립된 반 닫힘(half close)가 활성화됐는지에 따라 다르다.

독립된 반 닫힘이 활성화돼 있고 업스트림 프로토콜이 HTTP/2나 HTTP/3 중 하나인 경우 스트림은 요청과 응답이 완료된 시점에 소멸한다. 즉 트레일러나 양 방향에 END_STREAM이 설정된 헤더/본문을 수신하면 스트림이 종료되고 응답이 성공(2xx) 상태 코드가 된다.

업스트림 프로토콜이 HTTP/1이거나 독립된 반 닫힘 이 비활성화된 경우 스트림은 응답을 완료하고 스트림 끝에 도달하면 소멸한다. 즉, 트레일러나 END_STREAM이 설정된 응답 헤더/본문을 수신하면 요청이 완료되지 않았더라도 스트림을 종료한다. 응답 완료 시점에 요청이 완료되지 않은 경우 스트림을 리셋한다.

오류나 타임아웃이 발생하거나 피어가 HTTP/2나 HTTP/3 스트림을 리셋하는 경우 프록시를 조기에 멈출 수 있다.
