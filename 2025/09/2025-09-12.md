# 2025-09-12

## Envoy

### 아키텍처 개요

#### 업스트림 클러스터

##### 아웃라이어 감지

###### 감지 유형

**실패율**

실패율 기반 아웃라이어 감지는 클러스터의 각 호스트의 성공률 데이터를 기반으로 한다는 점에서 성공률 감지와 비슷하게 동작한다. 하지만 클러스터 전체의 평균 성공률과 비교하는 대신 사용자가 구성한 플랫(flat) 임계치와 비교한다. 이 임계치는 [outlier_detection.failure_percentage_threshold][api-clusters-outlier-detection-failure-percentage-threshold] 필드로 구성할 수 있다.

실패율 기반 아웃라이어 감지를 위한 다른 구성 필드들은 성공률 감지를 위한 필드와 비슷하다. 실패율 기반 감지는 [outlier_detection.split_external_local_origin_errors][api-clusters-outlier-detection-split-external-local-origin-errors]도 따른다. 외부와 지역적으로 유래한 오류에 대한 퍼센티지는 [outlier_detection.enforcing_failure_percentage][api-clusters-outlier-detection-enforcing-failure-percentage]와 [outlier_detection.enforcing_failure_percentage_local_origin][api-clusters-outlier-detection-enforcing-failure-percentage-local-origin]으로 제어한다. 성공률 감지에서처럼 호스트의 집계 주기 동안의 요청 볼륨이 [outlier_detection.failure_percentage_request_volume][api-clusters-outlier-detection-failure-percentage-request-volume] 값보다 작으면 감지가 수행되지 않는다. 필요한 최소한의 요청 볼륨을 가진 호스트의 수가 [outlier_detection.failure_percentage_minimum_hosts][api-clusters-outlier-detection-failure-percentage-minimum-hosts] 값보다 작은 경우에도 감지는 수행되지 않는다.

[api-clusters-outlier-detection-failure-percentage-threshold]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/cluster/v3/outlier_detection.proto#envoy-v3-api-field-config-cluster-v3-outlierdetection-failure-percentage-threshold
[api-clusters-outlier-detection-split-external-local-origin-errors]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/cluster/v3/outlier_detection.proto#envoy-v3-api-field-config-cluster-v3-outlierdetection-split-external-local-origin-errors
[api-clusters-outlier-detection-enforcing-failure-percentage]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/cluster/v3/outlier_detection.proto#envoy-v3-api-field-config-cluster-v3-outlierdetection-enforcing-failure-percentage
[api-clusters-outlier-detection-enforcing-failure-percentage-local-origin]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/cluster/v3/outlier_detection.proto#envoy-v3-api-field-config-cluster-v3-outlierdetection-enforcing-failure-percentage-local-origin
[api-clusters-outlier-detection-failure-percentage-request-volume]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/cluster/v3/outlier_detection.proto#envoy-v3-api-field-config-cluster-v3-outlierdetection-failure-percentage-request-volume
[api-clusters-outlier-detection-failure-percentage-minimum-hosts]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/cluster/v3/outlier_detection.proto#envoy-v3-api-field-config-cluster-v3-outlierdetection-failure-percentage-minimum-hosts
