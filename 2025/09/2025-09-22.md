# 2025-09-22

## Envoy

### 아키텍처 개요

#### 관측성

##### 액세스 로그

###### 세션 액세스 로그의 시작

**UDP 프록시**

UDP 프록시의 경우 HTTP를 통한 UDP 터널링이 구성되면 [터널 연결시 액세스 로그 플러시][api-extensions-filters-udp-access-log-options-flush-access-log-on-tunnel-connected]를 활성화해 업스트림 터널 커넥션이 성공적으로 수립되고 나면 액세스 로그를 기록하도록 할 수 있다.

**TCP 프록시**

TCP 프록시의 경우 [연결시 액세스 로그 플러시][api-extensions-filters-tcp-access-log-options-flush-access-log-on-connected]를 활성화해 성공적인 업스트림 커넥션 직후 일회성 액세스 로그 엔트리를 활성화할 수 있다.

**HTTP 커넥션 관리자**

HTTP 커넥션 관리자의 경우 [새 요청시 액세스 로그 플러시][api-extensions-filters-http-connection-manager-hcm-access-log-options-flush-access-log-on-new-request]를 활성화해 매번 새 HTTP 요청이 도착했을 때와 필터 체인이 처리되기 전에 일회성 액세스 로그 엔트리를 활성화할 수 있다.

> [!NOTE]
>
> 업스트림 호스트와 같은 일부 정보는 아직 사용 가능하지 않을 수 있다.

**HTTP 라우터 필터**

라우터 필터의 경우 [업스트림 스트림시 업스트림 로그 플러시][api-extensions-filters-upstream-access-log-options-flush-upstream-log-on-upstream-stream]를 활성화해 매번 업스트림과의 커넥션이 수립된 이후 새 업스트림 스트림이 다운트스림 스트림과 연관될 때마다 일회성 액세스 로그 엔트리를 활성화할 수 있다.

> [!NOTE]
>
> HTTP 요청이 재시도를 동반하는 경우 요청의 시작 업스트림 로그는 각 재시도마다 생성된다.

[api-extensions-filters-udp-access-log-options-flush-access-log-on-tunnel-connected]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/udp/udp_proxy/v3/udp_proxy.proto#envoy-v3-api-field-extensions-filters-udp-udp-proxy-v3-udpproxyconfig-udpaccesslogoptions-flush-access-log-on-tunnel-connected
[api-extensions-filters-tcp-access-log-options-flush-access-log-on-connected]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/tcp_proxy/v3/tcp_proxy.proto#envoy-v3-api-field-extensions-filters-network-tcp-proxy-v3-tcpproxy-tcpaccesslogoptions-flush-access-log-on-connected
[api-extensions-filters-http-connection-manager-hcm-access-log-options-flush-access-log-on-new-request]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/http_connection_manager/v3/http_connection_manager.proto#envoy-v3-api-field-extensions-filters-network-http-connection-manager-v3-httpconnectionmanager-hcmaccesslogoptions-flush-access-log-on-new-request
[api-extensions-filters-upstream-access-log-options-flush-upstream-log-on-upstream-stream]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/router/v3/router.proto#envoy-v3-api-field-extensions-filters-http-router-v3-router-upstreamaccesslogoptions-flush-upstream-log-on-upstream-stream
