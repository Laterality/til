# 2025-09-01

## Envoy

### 아키텍처 개요

#### 업스트림 클러스터

##### 집계 클러스터

집계 클러스터는 서로 다른 구성을 가진 여러 업스트림 클러스터 사이의 페일오버를 설정할 수 있게 한다. 예를 들어, [EDS][arch-upstream-clusters-service-discovery-eds] 클러스터에서 [STRICT_DNS][arch-upstream-clusters-service-dicovery-strict-dns] 클러스터로 전환하거나 [ROUND_ROBIN][arch-upstream-clusters-load-balancing-supported-load-balancers-weighted-round-robin] 로드 밸런싱을 사용하는 클러스터에서 [MAGLEV][arch-upstream-clusters-load-balancing-supported-load-balancers-maglev]를 사용하는 것으로 전환할 수 있다. 커넥션 타임아웃을 `0.1s`에서 `1s`로 바꾸는 등 타임아웃 변경에도 사용할 수 있다.

이 페일오버를 활성화하려면 [구성][api-extensions-cluster-aggeregate-cluster-config]에서 집계 클러스터가 다른 클러스터를 이름으로 참조해야 한다. [클러스터 목록][api-extensions-cluster-aggeregate-cluster-config-clusters]에서 이 클러스터의 순서는 암묵적으로 폴백 우선순위를 정의한다.

집계 클러스터는 로드 밸런싱에 등급을 매기는(tiered) 접근방식을 사용한다:

* 최상위 수준에서 사용할 클러스터와 우선순위를 결정한다.
* 그 다음 실제 로드 밸런싱은 선택된 클러스터의 고유 로드 밸런서로 넘긴다.

내부적으로, 이 최상위 수준 로드 밸런서는 참조된 클러스터의 모든 우선순위를 하나의 선형 리스트로 취급한다. 이렇게 함으로써 기존 로드 밸런싱 알고리즘을 재사용하고 필요에 따라 클러스터 사이에 트래픽을 원활하게 이동시킬 수 있다.

[arch-upstream-clusters-service-discovery-eds]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#arch-overview-service-discovery-types-eds
[arch-upstream-clusters-service-dicovery-strict-dns]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/service_discovery#arch-overview-service-discovery-types-strict-dns
[arch-upstream-clusters-load-balancing-supported-load-balancers-weighted-round-robin]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#arch-overview-load-balancing-types-round-robin
[arch-upstream-clusters-load-balancing-supported-load-balancers-maglev]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/load_balancers#arch-overview-load-balancing-types-maglev
[api-extensions-cluster-aggeregate-cluster-config]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/clusters/aggregate/v3/cluster.proto#envoy-v3-api-msg-extensions-clusters-aggregate-v3-clusterconfig
[api-extensions-cluster-aggeregate-cluster-config-clusters]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/clusters/aggregate/v3/cluster.proto#envoy-v3-api-field-extensions-clusters-aggregate-v3-clusterconfig-clusters
