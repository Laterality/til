# 2025-09-02

## Envoy

### 아키텍처 개요

#### 업스트림 클러스터

##### 집계 클러스터

###### 우선순위 집합 선형화

업스트림 호스트는 서로 다른 [우선순위 수준][arch-upstream-clusters-load-balancing-priority-levels]으로 그룹화되고 각 수준은 헬시, 퇴화, 언헬시가 될 수 있는 호스트들을 갖는다. 로드 밸런싱 중에 호스트 선택을 단순화하기 위해 여러 클러스터에 걸쳐 이 우선순위 수준들을 하나의 시퀀스로 선형화 병합한다.

예를 들어, 1차(primary) 클러스터가 세 개의 우선순위 수준을 갖고 2차(secondary)와 3차 클러스터가 각각 두 개씩 가지면 페일오버 순서는 다음과 같다:

* 1차
* 2차
* 3차

| 클러스터 | 우선순위 수준 | 선형화 이후 우선순위 수준 |
| -------- | ------------- | ------------------------- |
| 1차      | 0             | 0                         |
| 1차      | 1             | 1                         |
| 1차      | 2             | 2                         |
| 2차      | 0             | 3                         |
| 2차      | 1             | 4                         |
| 3차      | 0             | 5                         |
| 3차      | 1             | 6                         |

이 접근방식은 클러스터가 여럿인 경우에도 어떤 호스트가 우선순위에 따라 트래픽을 받을지 직관적으로 결정할 수 있게 한다.

[arch-upstream-clusters-load-balancing-priority-levels]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/upstream/load_balancing/priority#arch-overview-load-balancing-priority-levels
