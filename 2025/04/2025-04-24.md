# 2025. 04. 23.

## Reactor 3 Reference Guide

### 고급 기능과 개념

#### 리액티브 시퀀스에 컨텍스트 추가

##### 1. `Context`에 쓰기

개별 애플리케이션에 따라 이미 값이 들어있는 `ThreadLocal`을 `Context`의 엔트리로 저장해야 하거나 `Context`에만 값을 채우면 될 수 있다.

###### 1.1. `contextWrite` 연산자

`ThreadLocal`로 접근하고자 하는 값이 구독 시점에 존재하지 않는 경우 `Context`에 즉시 저장할 수 있다:

```java
// assuming TL is known to Context-Propagation as key TLKEY.
static final ThreadLocal<String> TL = new ThreadLocal<>();

// in the main Thread, TL is not set

Mono.deferContextual(ctx ->
  Mono.delay(Duration.ofSeconds(1))
      // we're now in another thread, TL is not explicitly set
      .map(v -> "delayed ctx[" + TLKEY + "]=" + ctx.getOrDefault(TLKEY, "not found") + ", TL=" + TL.get()))
.contextWrite(ctx -> ctx.put(TLKEY, "HELLO"))
.block(); // returns "delayed ctx[TLKEY]=HELLO, TL=null" in default mode
          // returns "delayed ctx[TLKEY]=HELLO, TL=HELLO" in automatic mode
```
