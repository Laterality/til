# 2025-12-15

## Envoy

### 아키텍처 개요

#### 고급

##### 속성(attributes)

###### 메타데이터와 필터 상태

필터 사이에 교환되는 데이터는 다음 속성으로 사용할 수 있다:

| 속성                  | 타입                                         | 설명                                       |
| --------------------- | -------------------------------------------- | ------------------------------------------ |
| metadata              | [Metadata][api-common-common-types-metadata] | 동적 요청 메타데이터                       |
| filter_state          | map<string, Value>                           | 필터 상태 이름을 객체 값으로 매핑          |
| upstream_filter_state | map<string, Value>                           | 업스트림 필터 상태 이름을 객체 값으로 매핑 |

필터 상태 값 표현은 다음 순서로 필터 상태 선언에 따라 결정된다:

- 값이 동적 `CelValue` 래퍼로 표현되면 `CelValue`가 그대로 반환된다.
- 키가 잘 알려져 있고 필드 리플렉션이 활성화돼 있으면 필드 이름들을 필드 값으로 매핑한 것을 반환한다.
- 그 외에는 값이 직렬화된 바이트로 반환된다.

데이터는 언제든 필터에 의해 갱신될 수 있으므로 이 속성들은 요청 처리 도중에 바뀔 수 있다.

[api-common-common-types-metadata]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/base.proto#envoy-v3-api-msg-config-core-v3-metadata
