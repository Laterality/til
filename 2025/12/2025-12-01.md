# 2025-12-01

## Envoy

### 아키텍처 개요

#### 기타 프로토콜

##### Redis

Envoy는 커맨드를 클러스터 내의 인스턴스 사이에 파티셔닝하는 Redis 프록시로 동작할 수 있다. 이 모드에서 Envoy의 목적은 일관성보다 가용성과 단절 내성을 유지하는 것이다. 이는 Envoy를 [Redis 클러스터][redis-cluster-spec]와 비교할 때 키 포인트다. Envoy는 최선 노력(best effort) 캐시로 설계돼 일관성이 없는 데이터를 보정(reconcile)하거나 클러스터 멤버십의 뷰를 전역적으로 일관되게 유지하려고 하지 않는다. 또한 접근 패턴, 방출(eviction), 격리 요구사항에 따라 서로 다른 워크로드로부터 다른 업스트림 클러스터로 커맨드를 라우팅하하는 것도 지원한다.

Redis 프로젝트는 Redis와 관련된 파티셔닝에 철저한 레퍼런스를 제공한다. "[파티셔닝: 여러 Redis 인스턴스 사이에 데이터를 나누는 방법][redis-scale-with-cluster]"을 참고하라.

**Envoy Redis의 기능:**

- [Redist 프로토콜][redis-serialization-protocol-spec] 코덱.
- 해시 기반 파티셔닝.
- Redis 트랜잭션 지원.
- Ketama 분산.
- 상세한 커맨드 통계.
- 능동적 및 수동적 헬스체킹.
- 해시 태깅.
- 접두어 라우팅.
- 다운스트림 클라이언트ㅌ와 업스트림 서버 인증 분리.
- 모든 요청 또는 쓰기 요청만 요청 미러링.
- [읽기 요청 라우팅][api-extensions-filters-redis-proxy-conn-pool-settings-read-policy] 제어. Redis 클러스터에서만 동작한다.

**계획된 개선 사항:**

- 추가적인 타이밍 통계.
- 서킷 브레이킹.
- 파편화된 커맨드에 대한 요청 접기(collapsing)
- 복제.
- 내장 재시도.
- 트레이싱.

[redis-cluster-spec]: https://redis.io/docs/latest/operate/oss_and_stack/reference/cluster-spec/
[redis-scale-with-cluster]: https://redis.io/docs/latest/operate/oss_and_stack/management/scaling/
[redis-serialization-protocol-spec]: https://redis.io/docs/latest/develop/reference/protocol-spec/
[api-extensions-filters-redis-proxy-conn-pool-settings-read-policy]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/network/redis_proxy/v3/redis_proxy.proto#envoy-v3-api-field-extensions-filters-network-redis-proxy-v3-redisproxy-connpoolsettings-read-policy
