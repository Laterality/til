# 2025-12-10

## Envoy

### 아키텍처 개요

#### 고급

##### 속성(attributes)

속성은 Envoy가 요청과 커넥션 처리 과정에서 제공하는 맥락적인 속성들을 의미한다. 점으로 구분된 경로(e.g. `request.path`)로 명명하며 고정된 타입(e.g. `string` 또는 `int`)를 갖고 상황에 따라 존재할 수도 존재하지 않을 수도 있다. 속성은 [RBAC 필터][arch-security-rbac]에서 CEL 런타임에 노출될뿐만아니라 `get_property` ABI 메서드를 통해  Wasm 확장에도 노출된다.

속성 값 유형은 다음으로 제한된다:

- `string`: UTF-8 문자열
- `bytes`: 바이트 버퍼
- `int`: 64비트 부호 있는(signed) 정수
- `uint`: 64비트 부호 없는(unsigned) 정수
- `bool`: 불리언
- `list`: 값 리스트
- `map`: 문자열 키에 연관된 배열
- `timestamp`: [Timestamp][protobuf-reference-protobuf-well-known-types-timestamp]에 의해 지정된 타임스탬프
- `duration`: [Duration][protobuf-reference-protobuf-well-known-types-duration]에 의해 지정된 기간
- 프로토콜 버퍼 메시지 타입

CEL은 `timestamp` 값에 대한 `getMont`와 같은 추상 타입에 동작하는 표준 헬퍼 함수를 제공한다. 정수 리터럴(e.g. `7`)은 `int` 타입으로 `uint` (e.g. `7u`)와는 구분되며 산순 변환은 자동으로 이뤄지지 않는다(명시적인 변환은 `uint(7)` 사용).

Wasm 확장은 속성 값들을 속성 타입에 따라 직렬화된 버퍼로 수신한다. string과 bytes는 그대로 전달되며 정수는 64비트로 직접 전달되고 timestamp와 duration은 나노초 근사치(approximated)가 되고 구조화된 값은 각각 쌍의 시퀀스로 변환된다.

[arch-security-rbac]: https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/security/rbac_filter#arch-overview-rbac
[protobuf-reference-protobuf-well-known-types-timestamp]: https://protobuf.dev/reference/protobuf/google.protobuf/#timestamp
[protobuf-reference-protobuf-well-known-types-duration]: https://protobuf.dev/reference/protobuf/google.protobuf/#duration
