# 2025-12-06

## Envoy

### 아키텍처 개요

#### 기타 프로토콜

##### Postgres

Envoy는 네트워크 수준 Postgres 스니핑 필터를 지원해 네트워크 관측성을 더한다. Postgres 프록시를 사용함으로써 Envoy는 [Postgres 프론트엔드/백엔드 프로토콜][postgresql-protocol]을 해독하고 해독된 정보로부터 통계를 수집할 수 있다.

Postgres 필터의 주요 목표는 Postgres 업스트림 서버에 영향이나 부하를 주지 않고 투명하게 런타임 통계를 포착하는 것이다. 필터는 현재 다음 기능을 제공한다:

- 비 SSL 트래픽 해독, SSL 트래픽은 무시한다.
- 세션 정보 해독.
- 인입 비 SSL 트래픽을 업스트림으로 포워드하기 전에 인코딩.
- 커밋과 롤백을 포함한 트랜잯견 정보 포착.
- 서로 다른 유형의 구문(INSERT, DELTE, UPDATE 등)에 대한 카운터 노출. 카운터는 클라이언트가 보낸 SQL 구문을 해독하는 것이 아니라 백엔드 CommandComplete 메시지를 해독해 갱신된다.
- 프론트엔드, 백엔드, 알 수 없는 메시지 수 카운트.
- 오류 식별과 백엔드 응답 통지.

Postgres 필터는 Postgres 배포에서 주목할 만한 문제들을 해결한다. 이러한 정보를 수집하는 것은 서버에 부하를 주거나 서버로부터 메타데이터에 대한 풀 기반 쿼리를 필요로 하는데, 이는 때로 외부 컴포넌트나 확장을 필요로 한다. 이 필터는 업스트림 Postgres 서버 성능에 영향을 주거나 다른 소프트웨어를 설치할 필요 없이 귀중한 관측성 정보를 제공한다.

Postgres 프록시 필터 [구성 레퍼런스][config-listeners-network-filters-postgres-proxy]

[postgresql-protocol]: https://www.postgresql.org/docs/current/protocol.html
[config-listeners-network-filters-postgres-proxy]: https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/network_filters/postgres_proxy_filter#config-network-filters-postgres-proxy
