# 2025-12-13

## Envoy

### 아키텍처 개요

#### 고급

##### 속성(attributes)

###### 커넥션 속성

다음 속성들은 다운스트림 커넥션이 수립되면 사용 가능하다(HTTP 요청에도 적용되므로 RBAC에 적합하다):

| 속성                                      | 타입   | 설명                                                                   |
| ----------------------------------------- | ------ | ---------------------------------------------------------------------- |
| source.address                            | string | 다운스트림 커넥션 원격 주소                                            |
| source.port                               | int    | 다운스트림 커넥션 원격 포트                                            |
| destination.address                       | string | 다운스트림 커넥션 로컬 주소                                            |
| destination.port                          | int    | 다운스트림 커넥션 로컬 포트                                            |
| connection.id                             | uint   | 다운스트림 커넥션 ID                                                   |
| connection.mtls                           | bool   | 다운스트림 커넥션에 TLS가 적용됐고 피어 인증서가 제시됐는지를 나타낸다 |
| connection.requested_server_name          | string | 다운스트림 TLS 커넥션에서 요청된 서버 이름                             |
| connection.tls_version                    | string | 다운스트림 LTS 커넥션의 TLS 버전                                       |
| connection.subject_local_certificate      | string | 다운스트림 TLS 커넥션의 로컬 인증서의 subject 필드                     |
| connection.subject_peer_certificate       | string | 다운스트림 TLS 커넥션의 피어 인증서의 subject 필드                     |
| connection.dns_san_local_certificate      | string | 다운스트림 TLS 커넥션의 로컬 인증서의 SAN 필드의 첫 번째 DNS 엔트리    |
| connection.dns_san_peer_certificate       | string | 다운스트림 TLS 커넥션의 피어 인증서의 SAN 필드의 첫 번째 DNS 엔트리    |
| connection.uri_san_local_certificate      | string | 다운스트림 TLS 커넥션의 로컬 인증서의 SAN 필드의 첫 번째 URI 엔트리    |
| connection.uri_san_peer_certificate       | string | 다운스트림 TLS 커넥션의 피어 인증서의 SAN 필드의 첫 번째 URI 엔트리    |
| connection.sha256_peer_certificate_digest | string | 제시된 경우 다운스트림 TLS 커넥션의 피어 인증서의 SHA256 다이제스트    |
| connection.transport_failure_reason       | string | 전송 실패 사유 e.g. 인증서 유효성 검증 실패                            |

다음 추가 속성은 다운스트림 커넥션이 종료되면 사용 가능하다:

| 속성                           | 타입   | 설명                                     |
| ------------------------------ | ------ | ---------------------------------------- |
| connection.termination_details | string | 커넥션의 내부 종료 상세 정보 (변경 대상) |
