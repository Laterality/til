# 2025-12-14

## Envoy

### 아키텍처 개요

#### 고급

##### 속성(attributes)

###### 업스트림 속성

다음 속성들은 업스트림 커넥션이 수립되면 사용 가능하다:

| 속성                                    | 타입                                            | 설명                                                                            |
| --------------------------------------- | ----------------------------------------------- | ------------------------------------------------------------------------------- |
| upstream.address                        | string                                          | 업스트림 커넥션 원격 주소                                                       |
| upstream.num_endpoints                  | uint64                                          | 업스트림 클러스터의 엔드포인트 수                                               |
| upstream.port                           | int                                             | 업스트림 커넥션 원격 포트                                                       |
| upstream.tls_version                    | string                                          | 업스트림 커넥션의 TLS 버전                                                      |
| upstream.subject_local_certificate      | string                                          | 업스트림 TLS 커넥션의 로컬 인증서의 subject 필드                                |
| upstream.subject_peer_certificate       | string                                          | 업스트림 TLS 커넥션의 피어 인증서의 subject 필드                                |
| upstream.dns_san_local_certificate      | string                                          | 업스트림 TLS 커넥션의 로컬 인증서의 SAN 필드의 첫 번째 DNS 엔트리               |
| upstream.dns_san_peer_certificate       | string                                          | 업스트림 TLS 커넥션의 피어 인증서의 SAN 필드의 첫 번째 DNS 엔트리               |
| upstream.uri_san_local_certificate      | string                                          | 업스트림 TLS 커넥션의 로컬 인증서의 SAN 필드의 첫 번째 URI 엔트리               |
| upstream.uri_san_peer_certificate       | string                                          | 업스트림 TLS 커넥션의 피어 인증서의 SAN 필드의 첫 번째 URI 엔트리               |
| upstream.sha256_peer_certificate_digest | string                                          | 존재하는 경우 업스트림 TLS 커넥션의 피어 인증서의 SHA256 다이제스트             |
| upstream.local_address                  | string                                          | 업스트림 커넥션의 로컬 주소                                                     |
| upstream.transport_failure_reason       | string                                          | 업스트림 전송 실패 사유 e.g. 인증서 유효성 검증 실패                            |
| upstream.request_attempt_count          | uint                                            | 업스트림 요청 시도 횟수. 값 '0'은 요청이 업스트림으로 시도된 적 없음을 의미한다 |
| upstream.cx_pool_ready_duration         | duration                                        | 업스트림 요청이 생성된 때부터 업스트림 커넥션 풀이 준비되기까지의 기간          |
| upstream.locality                       | [Locality][api-common-messages-common-locality] | 업스트림 호스트의 지역성 정보                                                   |

[api-common-messages-common-locality]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/config/core/v3/base.proto#envoy-v3-api-msg-config-core-v3-locality
