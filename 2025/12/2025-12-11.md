# 2025-12-11

## Envoy

### 아키텍처 개요

#### 고급

##### 속성(attributes)

###### 요청 속성

다음 요청 속성들은 일반적으로 초기 요청 처리에서 사용 가능해 RBAC 정책에 적합하다.

`request.*` 속성은 http 필터에서만 사용 가능하다.

| 속성                  | 타입                | 설명                                                               |
| --------------------- | ------------------- | ------------------------------------------------------------------ |
| request.path          | string              | URL의 경로 부분                                                    |
| request.url_path      | string              | 쿼리 문자열이 없는 URL의 경로 부분                                 |
| request.host          | string              | URL의 호스트 부분                                                  |
| request.scheme        | string              | URL의 스킴 부분 e.g. "http"                                        |
| request.method        | string              | 요청 메서드 e.g. "GET"                                             |
| request.headers       | map<string, string> | 소문자로 치환된(lower-cased) 헤더 이름으로 인덱스된 전체 요청 헤더 |
| request.headers_bytes | int                 | 요청 헤더의 바이트 크기                                            |
| request.referer       | string              | 레퍼러 요청 헤더                                                   |
| request.useragent     | string              | 사용자 에이전트 요청 헤더                                          |
| request.time          | timestamp           | 첫 바이트를 수신한 시간                                            |
| request.id            | string              | `x-request-id` 헤더 값에 해당하는 요청 ID                          |
| request.protocol      | string              | 요청 프로토콜 ("HTTP1.0", "HTTP/1.1", "HTTP/2", "HTTP/3")          |
| request.query         | string              | "name1=value1&name2=value2" 형식의 URL의 쿼리 부분                 |

`request.headers`의 헤더 값들은 다중 값인 경우 쉼표로 구분된다.

요청이 완료되면 추가 헤더를 사용할 수 있다:

| 속성               | 타입     | 설명                                                             |
| ------------------ | -------- | ---------------------------------------------------------------- |
| request.duration   | duration | 요청의 총 기간                                                   |
| request.size       | int      | 요청 본문 크기. Content length 헤더가 사용 가능한 경우 사용된다. |
| request.total_size | int      | 압축되지 않은 헤더의 근사 크기를 포함한 총 요청 크기             |
