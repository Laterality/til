# 2025-12-20

## Envoy

### 아키텍처 개요

#### 고급

##### 제네릭 일치

###### 일치 API

**입력과 일치 알고리즘**

일치 입력은 일치에 쓰일 입력 값을 추출하는 방법을 정의한다. 입력 함수는 컨텍스트에 민감하다. 예를 들어, HTTP 헤더 입력은 HTTP 컨텍스트에서만 적용할 수 있다. e.g. HTTP 요청 일치.

**HTTP 입력 함수**
이 입력 함수들은 HTTP 요청 일치에 사용할 수 있다:

- [요청 헤더 값.][api-types-common-http-inputs-matching-request-headers]
- [요청 트레일러 값.][api-types-common-http-inputs-matching-request-trailers]
- [응답 헤더 값.][api-types-common-http-inputs-matching-response-headers]
- [응답 트레일러 값.][api-types-common-http-inputs-matching-response-trailers]
- [쿼리 파라미터 값.][api-types-common-http-inputs-matching-query-params]
- [동적 메타데이터.][api-common-common-network-matching-inputs-matching-dynamic-metadata]

**네트워크 입력 함수**

이 입력 함수들은 TCP 커넥션, UDP 데이터그램, HTTP 요청 일치에 사용할 수 있다:

- [목적지 IP.][api-common-common-network-matching-inputs-matching-destination-ip]
- [목적지 포트.][api-common-common-network-matching-inputs-matching-destination-port]
- [소스 IP.][api-common-common-network-matching-inputs-matching-source-ip]
- [소스 포트.][api-common-common-network-matching-inputs-matching-source-port]

이 입력 함수들은 TCP 커넥션과 HTTP 요청 일치에 사용할 수 있다:

- [직접 소스 IP.][api-common-common-network-matching-inputs-matching-direct-source-ip]
- [소스 유형.][api-common-common-network-matching-inputs-matching-source-type]
- [서버 이름.][api-common-common-network-matching-inputs-matching-server-name]
- [네트워크 네임스페이스.][api-common-common-network-matching-inputs-matching-network-namespace]
- [필터 상태.][api-common-common-network-matching-inputs-matching-filter-state]

이 입력 함수들은 TCP 커넥션 일치에 사용할 수 있다:

- [전송 프로토콜.][api-common-common-network-matching-inputs-matching-transport-protocol]
- [애플리케이션 프로토콜.][api-common-common-network-matching-inputs-matching-application-protocol]

**SSL 입력 함수**

이 입력 함수들은 TCP 커넥션과 HTTP 요청 일치에 사용할 수 있다:

- [URI SAN.][api-common-common-ssl-matching-inputs-matching-uri-san]
- [DNS SAN.][api-common-common-ssl-matching-inputs-matching-dns-san]
- [Subject.][api-common-common-ssl-matching-inputs-matching-subject]

**전송 소켓 일치 입력 함수**

이 입력 함수들은 클러스터의 전송 소켓 일치에 사용할 수 있다:

- 엔드포인트 메타데이터 - 전송 소켓 선택에 대해 선택된 엔드포인트로부터 메타데이터를 추출한다.
- 지역성 메타데이터 - 전송 소켓 선택에 대햇 엔드포인트의 지역성으로부터 메타데이터를 추출한다.
- 필터 상태: 전송 소켓 옵션을 통해 다운스트림 커넥션에서 업스트림 커넥션에 명시적으로 공유되는 필터 상태로부터 값을 추출한다. 이는 다운스트림 커넥션 기반 전송 소켓 선택을 가능케 한다.

**공용 입력 함수**

이 입력 함수들은 모든 컨텍스트에서 사용할 수 있다:

- [환경 변수.][api-common-environment-variable-input-matching-environment-variable]

**커스텀 일치 알고리즘**

내장 exact와 prefix 일치자 외에 이 커스텀 일치자를 일부 컨텍스트에서 사용할 수 있다:

- 네트워크 입력에 적용하는 [IP 범위 일치자][api-common-ip-matcher].
- 네트워크와 HTTP 입력에 적용하는 [트라이(trie) 기반 서버 이름 일치자][api-common-messages-xds-server-name-matcher].
- [Common Expression Language][cel-spec] (CEL) 기반 일치:
  - CEL 일치 데이터 입력: [CEL 데이터 입력 값][api-common-xds-common-http-inputs-http-attribite-cel-match-input].
  - CEL 일치 입력 일치자: [CEL 입력 일치자][api-common-xds-common-expression-language-matchers-cel-matcher].
- [Hyperscan 일치자][api-extensions-contrib-extensions-hyperscan]를 사용한 정규식 일치.

[api-types-common-http-inputs-matching-request-headers]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/type/matcher/v3/http_inputs.proto#extension-envoy-matching-inputs-request-headers
[api-types-common-http-inputs-matching-request-trailers]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/type/matcher/v3/http_inputs.proto#extension-envoy-matching-inputs-request-trailers
[api-types-common-http-inputs-matching-response-headers]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/type/matcher/v3/http_inputs.proto#extension-envoy-matching-inputs-response-headers
[api-types-common-http-inputs-matching-response-trailers]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/type/matcher/v3/http_inputs.proto#extension-envoy-matching-inputs-response-trailers
[api-types-common-http-inputs-matching-query-params]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/type/matcher/v3/http_inputs.proto#extension-envoy-matching-inputs-query-params
[api-common-common-network-matching-inputs-matching-dynamic-metadata]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-dynamic-metadata
[api-common-common-network-matching-inputs-matching-destination-ip]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-destination-ip
[api-common-common-network-matching-inputs-matching-destination-port]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-destination-port
[api-common-common-network-matching-inputs-matching-source-ip]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-source-ip
[api-common-common-network-matching-inputs-matching-source-port]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-source-port
[api-common-common-network-matching-inputs-matching-direct-source-ip]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-direct-source-ip
[api-common-common-network-matching-inputs-matching-source-type]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-source-type
[api-common-common-network-matching-inputs-matching-server-name]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-server-name
[api-common-common-network-matching-inputs-matching-network-namespace]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-network-namespace
[api-common-common-network-matching-inputs-matching-filter-state]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-filter-state
[api-common-common-network-matching-inputs-matching-transport-protocol]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-transport-protocol
[api-common-common-network-matching-inputs-matching-application-protocol]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/network/v3/network_inputs.proto#extension-envoy-matching-inputs-application-protocol
[api-common-common-ssl-matching-inputs-matching-uri-san]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/ssl/v3/ssl_inputs.proto#extension-envoy-matching-inputs-uri-san
[api-common-common-ssl-matching-inputs-matching-dns-san]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/ssl/v3/ssl_inputs.proto#extension-envoy-matching-inputs-dns-san
[api-common-common-ssl-matching-inputs-matching-subject]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/ssl/v3/ssl_inputs.proto#extension-envoy-matching-inputs-subject
[api-common-environment-variable-input-matching-environment-variable]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/common_inputs/environment_variable/v3/input.proto#extension-envoy-matching-common-inputs-environment-variable
[api-common-ip-matcher]: https://www.envoyproxy.io/docs/envoy/latest/xds/type/matcher/v3/ip.proto#envoy-v3-api-msg-xds-type-matcher-v3-ipmatcher
[api-common-messages-xds-server-name-matcher]: https://www.envoyproxy.io/docs/envoy/latest/xds/type/matcher/v3/domain.proto#envoy-v3-api-msg-xds-type-matcher-v3-servernamematcher
[cel-spec]: https://github.com/google/cel-spec
[api-common-xds-common-http-inputs-http-attribite-cel-match-input]: https://www.envoyproxy.io/docs/envoy/latest/xds/type/matcher/v3/http_inputs.proto#envoy-v3-api-msg-xds-type-matcher-v3-httpattributescelmatchinput
[api-common-xds-common-expression-language-matchers-cel-matcher]: https://www.envoyproxy.io/docs/envoy/latest/xds/type/matcher/v3/cel.proto#envoy-v3-api-msg-xds-type-matcher-v3-celmatcher
[api-extensions-contrib-extensions-hyperscan]: https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/matching/input_matchers/hyperscan/v3alpha/hyperscan.proto#envoy-v3-api-msg-extensions-matching-input-matchers-hyperscan-v3alpha-hyperscan
