# 2023. 10. 08.

## Elasticsearch(7.10)

### 집계 - 버킷 집계

버킷 집계는 지표 집계처럼 필드에 대한 지표를 계산하지는 않지만, 그 대신 도큐먼트 버킷을 만든다. 각 버킷은 현재  컨텍스트의 도큐먼트가 해당하는지를 결정하는 (집계 유형에 따른)기준과 연관된다. 다른 말로 하면, 버킷은 효과적으로 도큐먼트 집합을 정의한다. 버킷 자체에 더해서 `bucket` 집계는 각 버킷에 해당하는 도큐먼트의 수를 계산해 반환한다.

버킷 집계는 `metrics` 집계와 반대로 서브 집계를 가질 수 있다. 이 서브 집계들은 자신의 "부모" 버킷 집계에 의해 생성된 집계에 대해 집계된다.

서로 다른 "버킷화" 전략과 함께 서로 다른 버킷 집계자가 존재한다. 일부는 단일 버킷을 정의하고 일부는 정해진 수의 여러 버킷을 정의하며, 나머지는 집계 과정에서 동적으로 버킷을 생성한다.

> 단일 응답에 허용되는 버킷의 최대 수는 동적 클러스터 설정 [`search.max_buckets`][settings-max-buckets]에 의해 제한된다. 기본값은 65,535이다. 제한을 초과하는 응답을 반환하는 요청은 예외와 함께 실패한다.



[settings-max-buckets]: https://www.elastic.co/guide/en/elasticsearch/reference/7.10/search-settings.html#search-settings-max-buckets