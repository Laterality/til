# 2023. 09. 21.

## Elasticsearch(7.10)

### 쿼리 DSL - `minimum_should_match` 파라미터

`minimum_should_match` 파라미터에 가능한 값은 다음과 같다:

| 타입                  | 예시          | 설명                                                         |
| --------------------- | ------------- | ------------------------------------------------------------ |
| Integer               | `3`           | 선택 사항 절(cluase)의 수와 관계 없이 고정된 값을 나타낸다.  |
| Negative integer      | `-2`          | 선택 사항 절의 총 수를 나타낸다. 숫자에 반드시 마이너스를 붙여야 한다. |
| Percentage            | `75%`         | 총 수에서 필요한 선택 사항 절의 비율을 나타낸다. 퍼센티지에서 계산된 숫자는 내림해서 최솟값으로 사용된다. |
| Negative percentage   | `-25%`        | 총 수에서 빠질 수 있는 선택 사항 절의 비율을 나타낸다. 퍼센티지에서 계산된 숫자는 총 합에서 빼 최솟값을 결정하기 전에 내림한다. |
| Combination           | `3<90%`       | 양의 정수 뒤에 보다 작은(<) 기호가 붙고 그 뒤에 앞에서 언급된 임의의 지정자가 붙는 형식은 조건부 명세다. 이는 선택 사항 절의 수가 정수와 같거나 보다 작은 경우 이 절이 모두 필요하고, 정수보다 큰 경우 명세를 적용한다. 이 예제에서는 1개에서 3개의 절은 모두 필요하고 4개 이상의 절은 90%가 필요하다. |
| Multiple combinations | `2<-25% 9<-3` | 공백으로 여러 조건부 명세를 구분할 수 있다. 각각은 앞의 것보다 큰 수일 때만 유효하다. 이 예제에서는 1개에서 2개인 경우 모두 필요하고 3개에서 9개인 경우 전체의 25%가 필요하며, 9개보다 많은 경우 3 개가 필요하다. |

**참고: **

퍼센티지를 사용할 때 음수 값은 일부 상황(edge case)에서 다르게 쓰일 수 있다.  4개의 절에서 75%와 -25%는 같은 의미지만 5개의 절에서 75%는 3개가 필요하고 -25%는 4개가 필요하다.

명세에 따른 계산이 선택 사항 절이 필요치 않은 것으로 결정하면 검색 시점에 BooleanQueries에 관한 일반적인 규칙을 적용한다(필수 절이 없는 BooleanQuery는 적어도 하나의 선택 사항 절에 일치해야 한다).

숫자 계산에 어떻게 되는지와 관계없이 선택 사항 절의 수보다 많은 값이나 1보다 작은 값은 쓰이지 않는다(ie: 계산 결과가 얼마나 크거나 작든, 일치해야 하는 최솟값은 1보다 작거나 절의 수보다 많지 않다).

