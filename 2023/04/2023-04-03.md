# 2023. 04. 03.

## Elasticsearch(7.10)

### 쿼리 DSL - 쿼리와 필터 컨텍스트

#### 쿼리와 필터 컨텍스트 예시

아래는 `search` API의 쿼리와 필터 컨텍스트에서 사용되는 쿼리 절(clause)의 예시다. 이 쿼리는 다음 조건을 모두 만족하는 도큐먼트에 일치한다:

* `title` 필드가 단어 `search`를 포함한다.
* `content` 필드가 단어 `elasticsearch`를 포함한다.
* `status` 필드가 정확히 일치하는 단어 `published`를 포함한다.
* `published_date` 필드가 2015년 1월 1일 이후의 날짜에 포함된다.

```http
GET /_search
{
  "query": { // 1. `query` 파라미터는 쿼리 컨텍스트를 나타낸다.
    "bool": { // 2. `bool`과 두 개의 `match` 절은 쿼리 컨텍스트에서 사용돼 각 도큐먼트가 얼마나 잘 일치하는지 측정하는 데 사용된다.
      "must": [
        { "match": { "title":   "Search"        }},
        { "match": { "content": "Elasticsearch" }}
      ],
      "filter": [ // 3. `filter` 파라미터는 필터 컨텍스트를 나타낸다. `term`과 `range` 절은 필터 컨텍스트에서 사용된다. 이들은 일치하지 않는 도큐먼트를 걸러내지만 일치하는 도큐먼트의 점수에는 영향을 주지 않는다.
        { "term":  { "status": "published" }},
        { "range": { "publish_date": { "gte": "2015-01-01" }}}
      ]
    }
  }
}
```

> 쿼리 컨텍스트에서 쿼리에 대해 계산된 점수는 단정밀도 부동소수점수로 표현된다. 24비트의 정밀도를 가진다. 정밀도를 초과하는 점수는 손실 변환된다.

> 일치하는 도큐먼트의 점수에 영향을 줘야 하는 조건을 쿼리 컨텍스트에서 쿼리 절로 사용하고 나머지 모든 쿼리 절은 필터 컨텍스트에서 사용하라.