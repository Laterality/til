# 2023. 03. 20.

## Elasticsearch(7.10)

### 데이터 검색 - 검색 결과 정렬

#### 검색 모드 옵션

Elasticsearch는 배열이나 다중 값 필드에 의한 정렬을 지원한다. `mode` 옵션은 도큐먼트를 정렬할 때 배열에서 어느 값을 선택할 지 통제한다. `mode` 옵션은 다음 값을 가질 수 있다:

| 옵션 값  | 설명                                                         |
| -------- | ------------------------------------------------------------ |
| `min`    | 가장 낮은 값을 선택한다.                                     |
| `max`    | 가장 높은 값을 선택한다.                                     |
| `sum`    | 모든 값의 합을 정렬 값으로 사용한다. 숫자 기반 배열 필드에만 적용할 수 있다. |
| `avg`    | m모든 값의 평균을 정렬 값으로 사용한다. 숫자 기반 배열 필드에만 적용할 수 있다. |
| `median` | 모든 값의 중간값을 정렬 값으로 사용한다. 숫자 기반 배열 필드에만 적용할 수 있다. |

오름차순 정렬의 기본 정렬 모드는 `min`으로, 가장 낮은 값을 선택한다. 내림차순 정렬 모드의 기본 정렬 모드는 `max`로, 가장 높은 값을 선택한다.

#### 정렬 모드 사용 예제

아래 예제에서 가격 필드는 도큐먼트마다 여러 가격을 갖는다. 이 경우 결과 히트는 도큐먼트 별로 가격의 평균에 따라 오름차순으로 정렬될 것이다.

```http
PUT /my-index-000001/_doc/1?refresh
{
   "product": "chocolate",
   "price": [20, 4]
}

POST /_search
{
   "query" : {
      "term" : { "product" : "chocolate" }
   },
   "sort" : [
      {"price" : {"order" : "asc", "mode" : "avg"}}
   ]
}
```

