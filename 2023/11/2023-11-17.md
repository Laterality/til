# 2023. 11. 17.

## Elasticsearch(7.10)

### 집계 - 버킷 집계

#### Diversified sampler 집계

##### 한계

###### `breadth_first` 집계 하위에는 중첩 불가

퀄리티 기반 필터인 diversified_sampler 집계는 각 도큐먼트에 대해 도출된 연관성 점수에 접근해야 한다. `terms` 집계의  `collect_mode`가 기본값 `depth_first` 모드에서 `breadth_first` 모드로 전환되면 이 점수를 버리므로 `terms` 집계 하위에는 중첩될 수 없다. 이 경우에는 오류를 던진다.

###### 제한된 중복 제거 로직

중복 제거 로직은 샤드 수준에서만 적용하므로 샤드 간에는 적용하지 않는다.

###### 지리/날짜 필드에 대해 특화된 구문 없음

현재 다각화 값을 정의하는 구문은 `field`나 `script`에 의해 정의된다. 여기에는 "7d"(7일)과 같은 지리나 날짜 단위를 위한 구문 지원이 없다. 이 지원은 추후 릴리즈에서 추가될 수도 있지만 현재로선 사용자가 스크립트를 사용해 값을 정렬해야 한다.