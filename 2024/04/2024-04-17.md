# 2024. 04. 17.

## Elasticsearch(7.10)

### 집계 - 파이프라인 집계

#### 데이터의 갭(gap) 처리

실세계의 데이터에는 종종 노이즈와 때로는 데이터가 존재하지 않는 갭(gap)이 있다. 이는 다양한 이유로 발생할 수 있는데, 가장 흔한 것은:

- 버킷에 들어간 도큐먼트가 필요한 필드를 가지고 있지 않은 경우
- 하나 이상의 버킷에 대해 쿼리에 일치하는 도큐먼트가 없는 경우
- 의존성이 있는 다른 버킷에 값이 누락된 경우와 같이 계산중인 지표가 값을 만들어낼 수 없는 경우. 일부 파이프라인 집계는 만족해야 하는 특정 요구사항들이 있다(e.g. derivative는 이전 값이 없기 때문에 첫 번째 값에 대한 지표를 계산하지 못하고 HolWinters 이동 평균은 계산을 시작하기 위해 "웜업"이 필요한 경우 등).

갭 정책은 파이프라인 집계에 "갭이 있거나(gappy)" 데이터가 누락된 경우 원하는 동작을 알리는 메커니즘이다. 모든 파이프라인 집계는 `gap_policy` 파라미터를 갖는다. 현재 두 가지 정책을 선택할 수 있다:

***skip***

이 옵션은 누락된 데이터를 버킷이 없는 경우처럼 취급한다. 버킷을 건너뛰고 사용 가능한 다음 값을 사용해 계산을 계속한다.

***insert_zeros***

이 옵션은 누락된 값을 `0`으로 대체하고 파이프라인 집계는 평소처럼 계산한다.