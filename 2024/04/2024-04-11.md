# 2024. 04. 11.

## Elasticsearch(7.10)

### 집계 - 지표

#### Weighted avg 집계

집계되는 도큐먼트로부터 추출된 숫자 값들의 가중 평균을 계산하는 `single-value` 지표 집계. 값은 도큐먼트의 특정 숫자 필드에서 추출하거나 제공한 스크립트를 통해 생성할 수 있다.

정규 평균을 계산할 때는 각 데이터포인트가 같은 "가중치"를 가져 최종 값에 동등하게 기여한다. 반면 가중 평균은 각 데이터포이늩에 다른 가중치를 둔다. 각 데이터포인트의 크기가 최종 값에 기여한다.

가중 평균을 식으로 나타내면 `∑(value * weight) / ∑(weight)`이다.

정규 평균은 모든 값이 묵시적으로 `1`의 가중치를 갖는 가중 평균으로 생각할 수 있다.

**표 41. `weighted_avg` 파라미터**

| 파라미터 이름 | 설명                                                | 필수 여부 | 기본값 |
| ------------- | --------------------------------------------------- | --------- | ------ |
| `value`       | 값을 제공할 필드 또는 스크립트 구성                 | Required  |        |
| `weight`      | 가중치를 제공할 필드 또는 스크립트 구성             | Required  |        |
| `format`      | 숫자 응답 포매터                                    | Optional  |        |
| `value_type`  | 순수 스크립트나 매핑되지 않은 필드의 값에 대한 힌트 | Optional  |        |

`value`와 `weight` 객체는 필드별로 특화된 구성이다:

**표 42. `value` 파라미터**

| 파라미터 이름 | 설명                                | 필수 여부 | 기본값 |
| ------------- | ----------------------------------- | --------- | ------ |
| `field`       | 값이 추출될 필드                    | Required  |        |
| `missing`     | 필드가 완전히 누락된 경우 사용할 값 | Optional  |        |



**표 43. `weight` 파라미터**

| 파라미터 이름 | 설명                                    | 필수 여부 | 기본값 |
| ------------- | --------------------------------------- | --------- | ------ |
| `field`       | 가중치가 추출될 필드                    | Required  |        |
| `missing`     | 필드가 완전히 누락된 경우 사용할 가중치 | Optional  |        |