# 2024. 04. 13.

## Elasticsearch(7.10)

### 집계 - 파이프라인 집계

파이프라인 집계는 도큐먼트 집합보다는 다른 집계들로부터 만들어지는 출력에 대해 출력 트리에 정보를 추가해 동작한다. 여러 가지 유형의 파이프라인 집계가 있어 다른 집계들로부터 서로 다른 정보를 계산하지만 두 가지 유형으로 나눌 수 있다.

**부모(parent)**

​	자신의 부모 집계의 출력과 함께 제공되며 새로운 버킷이나 새로운 집계를 계산해 기존 버킷에 추가할 수 있는 파이프라인 집계 유형.

**형제(sibling)**

​	형제 집계의 출력과 함께 제공되며 형제 버킷으로 같은 레벨이 될 새 집계를 계산할 수 있다.

파이프라인 집계는 필요한 지표에 대한 경로를 나타내는 `buckets_path` 파라미터를 사용해 자신들의 계산에 필요한 집계를 참조할 수 있다. 이 경로를 정의하는 구문은 [`buckets_path` 구문][bucket-path] 섹션에서 찾을 수 있다.

파이프라인 집계는 서브 집계를 가질 수 없지만 유형에 따라 `buckets_paths`에서 다른 파이프라인을 참조해 파이프라인을 엮을 수 있다. 예를 들어, 두 Derivative를 엮어 두 번째 Derivative를 계산할 수 있다.

> 파이프라인 집계는 출력에 더하기만 하기 때문에 파이프라인 집계를 엮으면 각 파이프라인 집계의 출력이 최종 출력에 포함된다.



[bucket-path]: https://www.elastic.co/guide/en/elasticsearch/reference/7.10/search-aggregations-pipeline.html#buckets-path-syntax