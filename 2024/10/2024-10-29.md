# 2024. 10. 29.

## OpenID Connect Core 1.0

### 5. 클레임

#### 5.5. "claims" 요청 파라미터를 사용한 클레임 요청

##### 5.5.1. 개별 클레임 요청

`claims` 요청의 `userinfo`와 `id_token` 멤버는 둘 다 멤버 이름으로 요청중인 개별 클레임의 이름인 JSON 객체이다. 멤버 값은 **다음 중 하나여야 한다**:

* null

  이 클레임이 기본 방식으로 요청중임을 나타낸다. 특히, 이는 자발적 클레임(voluntary claim)이다. 예를 들어, 다음 클레임 요청

  ```
  "given_name": null
  ```

  은 기본 방식의 `given_name` 클레임을 요청한다.

* JSON 객체

  요청중인 클레임에 관한 추가 정보를 제공하는 데 쓰인다. 이 명세는 다음 멤버를 정의한다:

  * essential

    **선택사항**. 요청중인 클레임이 필수 클레임인지 여부를 나타낸다. 값이 `true`인 경우, 이 클레임은 필수 클레임이다. 예를 들어, 다음 클레임 요청

    ```
    "auth_time": {"essesntial": true}
    ```

    는 `auth_time` 클레임 값을 반드시 반환해야 함을 명시하는 데 쓰일 수 있다.

    값이 `false`인 경우, 이는 자발적 클레임임을 나타낸다. 기본값은 `false`이다.

    클레임을 필수 클레임으로 요청함으로써, RP는 이 클레임이 나타내는 최종 사용자가 최종 사용자에 의해 요청된 특정 작업을 위한 인가를 부드럽게 처리할 수 있게 한다. 특정 클레임의 설명에 달리 명시되지 않은 한, 클레임이 필수이든 자발적이든 최종 사용자가 클레임 사용을 허용하지 않거나 이들이 존재하지 않아 클레임을 사용할 수 없어 클레임이 반환되지 않은 경우에도 인가 서버는 **오류를 내선 안된다**.

  * value

    **선택사항**. 클레임이 특정 값과 함께 반환되도록 요청한다. 예를 들어, 다음 클레임 요청

    ```
    "sub": {"value": "248289761001"}
    ```

    은 요청이 대상자 식별자 `248289761001`인 최종 사용자에 적용됨을 명시하는 데 사용될 수 있다.

    `value` 멤버의 값은 요청중인 클레임에 대해 **유효한 값이어야 한다**. 개별 클레임의 정의는 해당 클레임을 요청할 때 `value` 조건이 사용되는 방법과 사용 여부에 대한 요구사항을 포함할 수 있다. 비교의 동등성(equality) 비교는 요청된 클레임 값이 일치하는지 여부를 결정하는 데 쓰일 수 있다.

    클레임 값이 요청된 값과 일치하지 않은 경우, 클레임은 응답에 포함되지 않는다. 이 클레임이 `sub`인 경우, [섹션 3.1.2.2][oidc-core-section-3-1-2-2]에 정의된대로, 불일치는 인증 실패로 이어져야 한다.

  * values

    **선택사항**. 반환될 클레임 선호도 순서인 값 집합 중 하나로 반환될 것을 요청한다. 수용 가능한 클레임 값이 선택 간으하도록 제공된다는 점을 제외하면 처리 방식은 `value` 요청과 동일하다.

    예를 들어, 다음 클레임 요청

    ```
    "acr": {"essential": true,
            "values": ["urn:mace:incommon:iap:silver",
                       "urn:mace:incommon:iap:bronze"]}
    ```

    은 `acr` 클레임이 필수적으로 값 `urn:mace:incommon:iap:silver` 또는 `urn:mace:incommon:iap:bronze` 중 하나로 반환돼야 함을 명시한다. 

    `values` 멤버 배열의 값들은 요청중인 클레임에 대해 **유효한 값이어야 한다**. 개별 클레임의 정의에는 해당 클레임을 요청할 때 사용되는 `values` 조건의 사용 방법과 사용 여부에 대한 요구사항이 포함될 수 있다. 동등성 비교는 요청된 클레임 값들이 일치하는지 여부를 결정하는 데 쓰인다.

    클레임 값이 요청된 값들 중 어느것과도 일치하지 않으면, 클레임은 응답에 포함되지 않는다.

  요청되는 클레임에 대한 추가 정보를 제공하기 위해 다른 멤버가 정의될 수 있다. 이해할 수 없는 멤버는 **무시해야 한다**.

[섹션 5.4][oidc-core-section-5-4]에 정의된대로, `claims` 요청 파라미터가 지원될 때, 클레임을 요청하는 스코프 값들은 개별 클레임의 집합을 요청하기 위한 효과적인 단축 수단이다. 예를 들어, 스코프 값 `openid email`과 액세스 토큰을 반환하는 `response_type`은 스코프 값 `openid`와 개별 클레임들에 대한 다음 요청과 동등하다.

`email` 스코프 값을 사용한 동등한 요청:

```
{
 "userinfo":
  {
   "email": null,
   "email_verified": null
  }
}
```





[oidc-core-section-3-1-2-2]: https://openid.net/specs/openid-connect-core-1_0.html#AuthRequestValidation
[oidc-core-section-5-4]: https://openid.net/specs/openid-connect-core-1_0.html#ScopeClaims