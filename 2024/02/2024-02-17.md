# 2024. 02. 17.

## Elasticsearch(7.10)

### 집계 - 지표 집계

#### Extended stats 집계

##### 표준 편차 바운드

기본적으로 `extended_stats` 지표는 평균으로부터 두 표준 편차의 플러스/마이너스 간격을 제공하는 `std_deviation_bounds`라는 객체를 반환할 것이다. 이는 데이터의 변화량을 시각화하는 유용한 방법이 될 수 있다. 세 개의 표준 편차와 같은 다른 경계를 원한다면 요청에 `sigma`를 설정할 수 있다:

```http
GET /exams/_search
{
  "size": 0,
  "aggs": {
    "grades_stats": {
      "extended_stats": {
        "field": "grade",
        "sigma": 3          // 1. `sigma`는 평균으로부터 얼마나 많은 표준 편차의 +/-를 나타낼지 제어한다.
      }
    }
  }
}
```

`sigma`는 음수가 아닌 임의의 double이 될 수 있다. 즉, `1.5`와 같이 정수가 아닌 값도 요청할 수 있다. 값 `0`은 유효하지만 `upper`와 `lower` 바운드의 평균을 반환한다.

`upper`와 `lower` 바운드는 인구 지표로 계산되므로 이들은 항상 `upper_population`과 `lower_population`과 같다.

> **표준 편차와 바운드는 정규성(normality)이 필요하다**
>
> 표준 편차와 그 바운드는 기본적으로 표현되지만 항상 모든 데이터셋에 적용할 수 있는 것은 아니다. 데이터가 일반적으로 분포돼 있어야 한다. 표준 편차의 뒤에 있는 통계학은 일반적으로 분표된 데이터를 가정하므로 데이터가 왼쪽이나 오른쪽으로 크게 치우쳐 있다면 잘못된 값이 반환될 수 있다.