# 2024. 02. 01.

## Elasticsearch(7.10)

### 집계 - 버킷 집계

#### Time series 집계

> **경고**: 이 기능은 테크니컬 프리뷰 단계에 있으며 이후 릴리즈에서 변경되거나 제거될 수 있다. Elastic은 이슈를 수정하기 위해 노력하지만 테크니컬 프리뷰의 기능은 공식 GA 기능의 SLA 지원 대상이 아니다.

시계열 집계는 시계열 인덱스를 사용해 생성된 데이터를 쿼리한다. 이는 주로 지표나 시간 요소를 가진 다른 요소와 같은 데이터이며 시계열 모드를 사용해 인덱스를 생성해야 한다.

데이터는 다른 인덱스처럼 시계열 인덱스에 추가할 수 있다:

```htttp
PUT /my-time-series-index-0/_bulk
{ "index": {} }
{ "key": "a", "val": 1, "@timestamp": "2022-01-01T00:00:10Z" }
{ "index": {}}
{ "key": "a", "val": 2, "@timestamp": "2022-01-02T00:00:00Z" }
{ "index": {} }
{ "key": "b", "val": 2, "@timestamp": "2022-01-01T00:00:10Z" }
{ "index": {}}
{ "key": "b", "val": 3, "@timestamp": "2022-01-02T00:00:00Z" }
```

시계열 집계를 수행하려면 집계 유형에 "time_series"를 지정한다. 불리언 "keyed"가 참이면 각 버킷에 유니크 키가 주어진다.

```http
GET /_search
{
  "aggs": {
    "ts": {
      "time_series": { "keyed": false }
    }
  }
}
```

이 요청은 해당 시계열의 모든 결과를 반환하지만 더 전형적인 쿼리는 서브 집계를 사용해 반환되는 데이터를 더 관련성 있는 것들로 축소한다.

##### Size

기본적으로 `time_series` 집계는 10000개의 결과를 반환한다. "size" 파라미터를 사용해 결과를 더 제한할 수 있다. 그 대신 서브 집계를 사용해 시계열 집계로 반환되는 값들의 양을 제한할 수 있다.

##### Keyed

`keyed` 파라미터는 각 버킷이 유니크한 키를 가진 맵으로 반환될지를 결정한다. 기본적으로 `keyed`는 false로 설정돼 버킷은 배열로 반환된다.