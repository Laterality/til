# 2024. 01. 21.

## Elasticsearch(7.10)

### 집계 - 버킷 집계

#### Terms 집계

##### 버킷별 도큐먼트 수 오차

두 번째 오차 값은 `show_term_doc_count_error` 파라미터를 true로 설정해 화성화할 수 있다:

```http
GET /_search
{
  "aggs": {
    "products": {
      "terms": {
        "field": "product",
        "size": 5,
        "show_term_doc_count_error": true
      }
    }
  }
}
```

이것은 집계에서 반환된 각 텀에 대한 오차 값을 보여주는데, 도큐먼트 수에서 *최악*의 경우를 나타내고, `shard_size` 파라미터의 값을 결정할 때 유용하다. 텀을 반환하지 않은 모든 샤드에서 반환된 마지막 텀에 대한 도큐먼트 수를 합해 계산된다.

이 오차들은 도큐먼트가 카운트 순으로 내림차순정렬돼 있을 때는 이 방법으로만 계산할 수 있다. 샤드가 다른 샤드의 결과에 나타난 특정 텀을 반환하지 않으면 자신의 인덱스에 해당 텀을 가지고 있지 않을 것이기 때문에 집계가 텀 값 자체로 (오름차순이나 내림차순)정렬된 경우 도큐먼트 수에는 오차가 없다. 집계가 서브 집계 혹은 도큐먼트 수 오름차순으로 정렬되면 도큐먼트 수의 오차를 결정할 수 없기 때문에 이를 나타내는 -1을 반환한다.