# 2024. 01. 15.

## Elasticsearch(7.10)

### 집계 - 버킷 집계

#### Significant text 집계

##### 제한 사항

###### 자식 집계 미지원

significant_text 집계는 다음과 같은 이유로 자식 집계를 지원하지 않는다:

* 메모리 소모가 많다
* 일반적으로 유용한 기능이 아니며 필요한 경우 다른 방식으로 대체할 수 있다

후보 텀의 규모는 일반적으로 크고 최종 결과를 반환하기 전에 크게 쳐낸다(pruned). 자식 집계를 지원하는 것은 추가적인 연산을 만들어내고 비효율적이다. 클라이언트는 항상 `significant_text` 요청으로부터 크게 정리된 경과 집합을 받아 `include` 절과 함께 `terms` 집계를 사용한 후속 쿼리를 요청하면 선택된 키워드에 대한 추가 분석을 위한 자식 집계는 더 효율적인 방식으로 실행된다.

###### 중첩 객체 미지원

significant_text 집계는 도큐먼트 JSON을 사용해 동작하기 때문에 현재 중첩 객체의 text 필드에 사용할 수 없다. 이는 저장된 JSON으로부터 일치하는 자식 도큐먼트에 일치하는 Lucene docID가 주어졌을 때 이 기능을 비효율적이게 만든다.

###### 근사치(approximate) 카운트

얼마나 많은 도큐먼트가 결과에 전달된 텀을 포함하는지는 각 샤드에서 반환된 샘플을 합해 계산되며 다음과 같다:

* 특정 샤드가 주어진 텀을 상위 샘플로 전달하지 않은 경우 낮다
* 삭제된 도큐먼트에서 발견된 것을 카운트할 수 있어 배경 빈도를 고려할 때는 높다

대부분 설계 결정처럼 이는 빠른 성능을 제공하기 위해 부정확성을 (보통은 작은)대가로 지불한 트레이드오프이다. 하지만 `size`와 `shard_size` 설정으로 정확성 수준을 제어하는 데 도움을 줄 수 있다.



