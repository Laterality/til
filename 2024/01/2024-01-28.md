# 2024. 01. 28.

## Elasticsearch(7.10)

### 집계 - 버킷 집계

#### Terms 집계

##### 실행 힌트

어떤 terms 집계인지에 따라 다른 메커니즘이 실행될 수 있다:

* 필드 값을 직접 사용해 버킷 별 데이터를 집계(`map`)
* 필드의 전역 순서를 사용해 전역 순서마다 하나의 버킷을 할당(`global_ordinals`)

Elasticsearch는 합리적인 기본값을 사용하려고 시도하기 때문에 일반적으로는 구성할 필요 없다.

`global_ordinals`는 `keyword` 필드에 대한 기본 옵션으로, 전역 순서를 사용해 동적으로 버킷을 할당하기 때문에 메모리 사용량은 집계 범위에 속한 도큐먼트의 값의 수에 선형적이다.

`map`은 아주 적은 수의 도큐먼트가 쿼리에 일치할 때만 고려된다. 그 외에는 순서 기반 실행 모드가 훨씬 빠르다. 기본적으로 `map`은 순서가 없는 스크립트를 실행할 때만 사용된다.

```http
GET /_search
{
  "aggs": {
    "tags": {
      "terms": {
        "field": "tags",
        "execution_hint": "map" // 1. 사용 가능한 값은 `map`, `global_ordinals`
      }
    }
  }
}
```

Elasticsearch는 실행 힌트를 적용할 수 없을 때는 무시하며, 이 힌트에 대한 하위 호환성은 보장되지 않는다.

