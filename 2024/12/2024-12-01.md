# 2024. 12. 01.

## OpenID Connect Core 1.0

### 10. 서명과 암호화

#### 10.2. 암호화

암호화 당사자는 수신자가 지원하는 알고리즘에 따라 암호화 알고리즘을 **선택해야 한다**.

* 비대칭 키: RSA

  내용을 암호화한 공개 키는 수신자가 JWK 집합 도큐먼트에 암호화에 사용하기 위해 게시한 **공개 키여야 한다**.  참조된 JWK 집합 도큐먼트에 여러 키가 있다면 JOSE 헤더에 `kid` 값을 **제공해야 한다**. 지원되는 RSA 암호화 알고리즘을 사용해 서명된 JWT를 암호화하는 데 사용할 무작위 내용 암호화 키를 암호화한다. 각 키의 사용은 암호화를 **포함해야 한다**.

* 비대칭 키: Elliptic Curve

  `JOSE` 헤더의 `epk` 요소를 위한 짧은 수명의(ephermeral) 타원 곡선 공개 키를 만든다. 키 협의 계산에 사용하기 위한 다른 공개 키는 수신자가 JWK 집합 도큐먼트에 게시한 **공개 키여야 한다**. 참조한 JWK 집합 도큐먼트에 여러 키가 있는 경우, JOSE 헤더의 `kid` 값을 **제공해야 한다**. ECDH-ES 알고리즘을 사용해 서명된 JWT를 암호화하는 데 사용할 내용 암호화 키를 협의한다. 각 키의 사용은 암호화를 **지원해야 한다**.

* 대칭 키

  대칭 암호화 키는 `client_secret` 값으로부터 파싱돼 `client_secret`의 UTF-8 표현의 옥텟의 SHA-2를 잘라내(truncated) 왼쪽을 사용한다. 256 비트 이하의 키에는 SHA-256를 사용한다. 257-384 비트의 키에는 SHA-384를 사용한다. 385-512 비트의 키에는 SHA-512를 사용한다. 해시 값은 AES 키 래핑이나 사용된 직접 암호화 알고리즘에 대해 적절한 비트 길이만큼의 왼쪽 비트를 유지한 채 **잘라내야 한다**. 예를 들어, `A128KW`에는 SHA-256 해시를 128비트로 잘라낸다. 512비트보다 큰 대칭 키가 필요한 경우, `client_secret`에서 파생된 다른 방법을 확장으로 정의해야 한다. 대칭 키는 비밀 유지가 불가하기 때문에 공개(비-기밀) 클라이언트에서 **사용해선 안된다**.

암호화된 요청에 필요한 보안 고려사항은 [섹션 16.21][oidc-core-section-16-21]을 참고하라.



[oidc-core-section-16-21]: https://openid.net/specs/openid-connect-core-1_0.html#NeedForEncryptedRequests