## 2021. 11. 30.

### RFC7519 - JSON Web Token

#### 7. JWT 생성과 유효성 검증(2)

##### 7.2. JWT 유효성 검증

JWT 유효성을 검증할 때는 다음 단계를 수행한다. 각 단계의 입출력 사이에 의존성이 없는 경우 순서는 중요하지 않다. 나열된 단계 중 하나라도 실패하면 해당 JWT는 거절돼야 한다. 즉, 애플리케이션에서 유효하지 않은 입력으로 취급해야 한다.

1. JWT가 적어도 하나의 쉼표(`.`) 문자를 갖는지 확인한다.
2. JWT의 첫 번째 쉼표(`.`) 이전 부분을 인코딩된 JOSE 헤더로 둔다.
3. 인코딩된 JOSE 헤더를 Base64url 디코드한다. 개행, 공백 또는 그 외 추가 문자를 사용하지 않는다.
4. 결과 옥텟 시퀀스가 RFC 7159를 따르는 완전히 유효한 JSON 객체의 UTF-8 인코딩된 표현인지 확인한다. JOSE 헤더는 이 JSON 객체로 둔다.
5. 결과 JOSE 헤더가 문법(syntax)과 의미(semantics) 모두 이해할 수 있고(understood) 지원되거나 이해할 수 없는 경우 무시하도록 명시된 파라미터들만을 갖는지 확인한다.
6. [JWE]의 Section 9에 기술된 방법을 사용하여 JWT가 JWS인지 JWE인지 결정한다.
7. JWT가 JWS인지 JWE인지에 따라 두 가지 경우가 있다:
   * JWT가 JWS인 경우 [JWS]에 명시된 단계를 따라 JWS 유효성을 검증한다. 메시지를 Base64url 디코딩한 결과로 둔다.
   * 그 외에, JWT가 JWE인 경우, [JWE]에 명시된 단계를 따라 JWE 유효성을 검증하낟. 메시지를 결과 평문으로 둔다.
8. JOSE 헤더의 "cry" (content type) 값이 "JWT"이면, 메시지는 서명이나 암호화가 중첩된 JWT이다. 이 경우  메시지를 JWT로 사용하여 1단계로 돌아간다.
9. 그 외에는 메시지를 base64url 디코드한다. 개행, 공백, 또는 그 외 추가 문자를 사용하지 않는다.
10. 결과 옥텟 시퀀스가 RFC 7159를 따르는 완전히 유효한 JSON 객체의 UTF-8 인코딩된 표현인지 확인한다. JWT 클레임 셋은 이 JSON 객체로 둔다.

마지막으로, 주어진 컨텍스트에서 어떤 알고리즘을 사용할 지는 애플리케이션의 결정사항임을 알아두자. JWT가 유효성 검증을 성공적으로 통과하더라도, JWT에  사용된 알고리즘을 애플리케이션이 수용할 수 없다면 JWT를 거절**하는 것이 좋다**.