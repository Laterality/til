## 2022. 02. 10.

#### Elasticsearch(7.10)

#### 인덱스 모듈 - 스토어

##### 데이터를 파일 시스템 캐시에 프리로드(preload)

> 고급 설정으로, 상세 내용은 추후에 변경될 수 있다.

기본적으로 Elasticsearch는 I/O 연산 캐싱을 전적으로 운영체제 파일 시스템 캐시에 의존한다. `index.store.preload`를 설정하여 운영체제에 핫 인덱스 파일의 내용을 열자마자 메모리에 로드하도록 할 수 있다. 이 설정은 파일 확장자 목록을 쉼표로 구분한 리스트로 받는다. 리스트에 있는 확장자의 파일은 열자마자 프리로드(preload)될 것이다. 이는 인덱스의 검색 성능을 높이는 데 유용할 수 있는데, 특히 호스트 운영체제가 재시작됐을 때, 이로 인해 파일 시스템 캐시가 사라진 경우가 있다. 하지만 데이터가 물리 메모리에 로드된 뒤 사용할 수 있기 때문에 인덱스를 여는 속도를 느리게 할 수 있다는 점을 기억하라.

이 설정은 최선의 노력일 뿐이며 스토어 유형과 호스트 운영체제에 따라 전혀 동작하지 않을 수 있다.

`index.store.preload`는 `config/elasticsearch.yml`에서 설정할 수 있는 정적 설정이다:

```yaml
index.store.preload: ["nvd", "dvd"]
```

혹은 인덱스 생성 시점에 인덱스 설정에서 할 수도 있다:

```http
PUT /my-index-000001
{
  "settings": {
    "index.store.preload": ["nvd", "dvd"]
  }
}
```

기본값은 빈 배열로, 파일 시스템 캐시에 아무것도 미리 로드하지 않는다. 활발하게 검색되는 인덱스에 대해서는 `["nvd", "dvd"]`로 설정해서 놈(norm)과 doc 값이 물리 메모리에 미리 로드되도록 할 수 있다. Elasticsearch가 임의 접근을 수행하기 때문에 처음에 살펴보는 파일 확장자가 두 개 존재한다.

`index.store.preload: ["*"]`처럼 와일드카드를 사용해 모든 파일이 미리 로드돼야 함을 나타낼 수도 있다. 하지만 모든 파일, 특히 저장된 필드와 텀 벡터를 로드하는 것은 일반적으로 유용하지 않다는 점을 기억하라. 따라서 인덱스에서 검색과 집계에 가장 중요한 부분인 `["nvd", "dvd", "tim", "doc", "dim"]`으로 설정해서 놈, doc 값, 텀 딕셔너리, 포스팅 리스트와 포인트를 프리로드하는 것이 더 낫다.

큰 병합 이후에 다시 열자마자 파일 시스템 캐시를 폐기하기 때문에 인덱싱과 검색을 *더 느리게* 만들 수 있어 이 설정은 호스트의 메인 메모리보다 큰 인덱스에 대해서는 위험한 설정이다. 

