# 2022. 05. 08.

## Elasticsearch(7.10)

### 매핑 - 필드 데이터 타입

#### Shape 필드 타입

##### 인덱싱 접근 방식

`geo_shape`과 마찬가지로 `shape` 필드 타입은 도형을 삼각형 메시로 분해하고 각각의 삼각형을 BKD 트리의 7차원점으로 인덱싱하는 방식으로 인덱스한다. 인덱서에 전달된 좌표는 단정밀도 부동소수점 값이므로 필드는 Java 가상 머신이 제공하는 것과 동일한 정확도(보통 `1E-38`)를 보장한다. 다각형/다중다각형의 경우 테셀레이터의 성능은 주로 도형을 정의하는 정점의 개수에 좌우된다.

###### 중요 참고사항

`relation`이 `contains`로 정의된 `shape` 쿼리인 `CONTAINS` 관계 쿼리는 ElasticSearch 7.5.0 이상에서 생성된 인덱스에 지원된다.

###### 예제

```http
PUT /example
{
  "mappings": {
    "properties": {
      "geometry": {
        "type": "shape"
      }
    }
  }
}
```

이 매핑 정의는 도형 필드를 shape 타입으로 매핑한다. 인덱서는 정점 값에 단정밀도 부동소수점 값을 사용하므로 정확도는 Java 가상 머신이 제공하는 `float`와 동일한 정확도(보통 `1E-38`)를 보장한다.

