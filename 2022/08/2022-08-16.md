# 2022. 08. 16.

## Elasticsearch(7.10)

### 텍스트 분석 - 텍스트 분석 개념

#### 인덱스와 검색 분석

##### 인덱스와 검색 분석기가 함께 동작하는 방법

대부분의 경우, 인덱스와 검색 시점에 같은 분석기가 사용돼야 한다. 이는 값과 필드에 대한 쿼리 문자열이 같은 토큰 형식으로 바뀌도록 보장한다. 그 결과로 검색 중에 토큰이 기대한대로 일치하도록 한다.

###### 예제

`text` 필드에 다음 값이 인덱스됐다고 하자:

```
The QUICK brown foxes jumped over the dog!
```

필드에 대한 인덱스 분석기는 값을 토큰으로 변환하고 정규화한다. 이 경우 각 토큰은 단어를 나타낸다:

```
[ quick, brown, fox, jump, over, dog ]
```

그 다음 이 토큰들이 인덱스된다.

이후, 사용자가 같은 `text` 필드를 아래처럼 검색하면:

```
"Quick fox"
```

사용자는 검색이 앞에서 인덱스한 `The QUICK brown foxes jumped over the dog!`와 일치할 것이라고 기대한다.

하지만 쿼리 문자열은 도큐먼트의 원본 텍스트에 사용된 단어와 정확히 일치하지 않는다:

* `quick` vs `QUICK`
* `fox` vs `foxes`

이를 고려하기 위해, 쿼리 문자열은 같은 분석기로 분석된다. 이 분석기는 다음 토큰을 만든다:

```
[ quick, fox ]
```

검색을 실행해 Elasticsearch가 이 쿼리 문자열 토큰을 인덱스된 `text` 필드와 비교한다.

| 토큰    | 쿼리 문자열 | `text` 필드 |
| ------- | ----------- | ----------- |
| `quick` | X           | X           |
| `brown` |             | X           |
| `fox`   | X           | X           |
| `jump`  |             | X           |
| `over`  |             | X           |
| `dog`   |             | X           |

필드 값과 쿼리 문자열이 같은 방법으로 분석됐으므로 비슷한 토큰을 생성한다. 토큰 `quick`과 `fox`는 정확히 일치한다. 즉, 검색은 사용자가 기대한 대로 `"The QUICK brown foxes jumped over the dog!"`를 가진 도큐먼트와 일치한다.