# 2022. 08. 17.

## Elasticsearch(7.10)

### 텍스트 분석 - 텍스트 분석 개념

#### 인덱스와 검색 분석

##### 다른 검색 분석기를 사용해야 하는 때

덜 흔하지만 때로는 인덱스와 검색 시점에 다른 분석기를 사용하는 것이 필요한 때가 있다. 이를 위해 Elasticsearch는 [별도의 검색 분석기를 명시][specify-search-analyzer]하는 것을 허용한다.

일반적으로 필드 값과 쿼리 문자열에 대해 같은 형식의 토큰을 사용할 때 별도의 검색 분석기를 명시하면 원치않거나 관련성이 적은 검색 결과가 나올 수 있다.

###### 예제

Elasticsearch는 특정 단어로 시작하는 단어만 찾는 검색엔진을 만들 수 있다. 예를 들어, `tr`에 대한 검색은 `tram`이나 `trope`를 반환하지만 `taxi`나 `bat`을 반환하진 않는다.

도큐먼트는 검색 엔진의 인덱스에 추가된다. 이 도큐먼트는 text` 필드에 아래와 같은 단어를 갖는다:

```
"Apple"
```

필드에 대한 인덱스 분석기는 값을 토큰으로 변환하고 정규화한다. 이 경우에는 각 토큰이 단어의 잠재적인 접두어를 나타낸다:

```http
[ a, ap, app, appl, apple]
```

그 다음 이 토큰들이 인덱스된다.

이후, 사용자가 같은 `text` 필드에 다음과 같이 검색하면:

```
"appli"
```

사용자는 `appliance`나 `application`과 같이 `appli`로 시작하는 단어만을 기대할 것이다. 검색은 `apple`과 일치하면 안된다.

하지만 인덱스 분석기가 이 쿼리 문자열을 분석하는 데 사용되면 다음과 같은 토큰을 만든다:

```
[ a, ap, app, appl, appli ]
```

Elasticsearch가 이 쿼리 문자열 토큰을 `apple`에 인덱스된 토큰과 비교하면 몇군데 일치하는 것을 발견한다.

| 토큰    | `appli` | `apple` |
| ------- | ------- | ------- |
| `a`     | X       | X       |
| `ap`    | X       | X       |
| `app`   | X       | X       |
| `appl`  | X       | X       |
| `appli` |         | X       |

즉, 검색이 의도치 않게 `apple`에 일치한다. 뿐만 아니라 `a`로 시작하는 모든 단어에 일치한다. 이를 고치려면 `text` 필드에 사용된 쿼리 문자열에 다른 검색 분석기를 명시해야 한다.

이 경우에는 접두어의 집합 대신 단일 토큰을 만들어내는 검색 분석기를 명시할 수 있다:

```
[ appli ]
```

이 쿼리 문자열 토큰은 `appli`로 시작하는 단어들에만 일치하여 사용자의 검색 기대치에 더 잘 맞을 것이다.





[specify-search-analyzer]: https://www.elastic.co/guide/en/elasticsearch/reference/current/specify-analyzer.html#specify-search-analyzer