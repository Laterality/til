## 2020. 11. 22.

### Spring Security for Servlet - 인증(30)

#### 익명 인증(1)

##### 개요

무엇이 허용되고 나머지가 허용되지 않는지를 명시적으로 지정해야 하는 곳에 "기본적으로 거부(deny-by-default)"하는 방식은 좋은 보안 사례로 꼽힌다. 인증되지 않은 사용자가 접근 가능한 것이 무엇인지를 정의하는 것도 비슷한 상황인데, 특히 웹 애플리케이션에서 그렇다. 많은 사이트가 몇 가지 URL들(홈이나 로그인 페이지 등)을 빼고는 사용자에게 인증을 요구한다. 이 경우, 보안 리소스보다는 이 특정 URL들에 대한 접근 구성 속성을 정의하는 것이 가장 쉽다. 다르게 생각하면, 때로는 `ROLE_SOMETHING`이 기본적으로 필요하며 애플리케이션의 홈, 로그인, 로그아웃 페이지와 같이 이 규칙에 대한 몇 가지 예외 사항을 허용한다고 볼 수도 있다. 또한 이 페이지들을 필터 체인에서 생략할 수 있기 때문에 접근 제어 검사를 우회하지만, 특히 페이지가 인증된 사용자에게 다르게 동작해야 하는 경우와 같은 다른 이유로 이를 원치 않을 수도 있다. 

익명 인증이 의미하는 바가 바로 이것이다. "익명으로 인증된" 사용자와 인증되지 않은 사용자 사이에 실질적으로 개념적인 차이가 없다는 점을 기억하라. Spring Security의 익명 인증은 접근 제어 속성을 구성하는 더 편리한 방법을 제공할 뿐이다. 예를 들어 `getCallerPrincipal`와 같은 서블릿 API 호출은 실제로는 `SecurityContextHolder`에 익명 인증 객체가 있더라도 여전히 null을 반환할 것이다.

어느 주체가 주어진 연산에 대한 책임이 있는지를 식별하기 위해 감사(auditing) 인터셉터가 `SecurityContextHolder`에 질의하는 경우와 같이 익명 인증이 유용한 상황은 더 있다. 클래스가 절대 `null`이 아니고 항상 `Authentication` 객체를 갖는 `SecurityContextHolder`를 알고 있다면 권한 제어를 더 강건하게 할 수 있다.

