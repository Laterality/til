## 2020. 05. 12.

### OpenTracing - 주입과 추출(6)

#### end-to-end 주입과 추출 전파 예시

앞의 내용을 구체적으로 살펴보기 위해, 다음과 같은 순서를 생각해보자:

1. *클라이언트* 프로세스가 `SpanContext` 인스턴스를 가지며 자체(home-grown) HTTP 프로토콜을 통해 RPC를 하려고 한다.
2. 이 클라이언트 프로세스가 활성 `SpanContext`, 텍스트 맵에 대한 형식 식별자 및 텍스트 맵 운반자를 파라미터로 전달하여 `Tracer.Inject(...)`를 호출한다.
3. `Inject`가 운반자에 텍스트 맵을 덧붙인다. 클라이언트 애플리케이션은 자체 HTTP 프로토콜 내에서 이 맵을 (e.g., 헤더로)인코딩한다.
4. *HTTP 요청이 발생하고 데이터가 프로세스 경계를 건넌다*.
5. 이제 서버 프로세스에서 애플리케이션 코드가 자체 HTTP 프로토콜로부터 텍스트 맵을 디코딩하고 텍스트 맵 운반자를 초기화하는 데 사용한다.
6. 서버 프로세스가 원하는 연산 이름, 텍스트 맵에 대한 형식 식별자 및 위의 운반자를 전달하여 `Tracer.Extract(...)`를 호출한다.
7. 데이터가 손상되었거나 다른 오류가 있는 경우, 해당 *서버*는 클라이언트에 있는 것과 동일한 트레이스에 속한 `SpanContext` 인스턴스를 갖는다.

[OpenTracing 유스케이스][opentracing-use-cases] 문서에서 다른 예시를 확인할 수 있다.



[opentracing-use-cases]: https://opentracing.io/docs/best-practices