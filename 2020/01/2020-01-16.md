## 2020. 01. 16

### 쿠버네티스 - 파드(Pod)

쿠버네티스에서 컨테이너를 오케스트레이션하는 최소 단위.

쿠버네티스는 개별 컨테이너를 실행하고 관리하는 대신, 파드(Pod)라고 하는, 하나 이상의 컨테이너로 이뤄진 컨테이너 그룹을 관리한다. 즉, 파드 내의 컨테이너들은 함께 실행되고 함께 종료된다. 또한, 파드 내의 컨테이너들은 같은 노드 내에서 실행된다.

#### 파드의 등장 배경

쿠버네티스는 왜 컨테이너 단위가 컨테이너 그룹을 파드라는 객체로 감싸 이를 관리할까?

컨테이너 중에서도 다른 컨테이너에 의존적인 컨테이너들이 있다. 웹 애플리케이션을 실행하는 컨테이너와 이 애플리케이션에서 발생하는 로그 파일을 다른 저장소로 스트리밍하는 컨테이너를 예로 들 수 있다. 사실상 이 두 컨테이너는 함께 실행되고 관리되는 것이 적절하다. 

둘을 한 컨테이너에 합쳐서 실행하면 안될까?

웹 애플리케이션과 로그 스트리밍 애플리케이션을 하나의 컨테이너에서 실행하는 경우도 생각할 수 있다. 하지만 컨테이너는 기본적으로 하나의 프로세스를 실행하도록 설계돼 있다. 두 애플리케이션이 하나의 컨테이너에서 실행되다가 어떤 이유로 종료되는 경우, 이를 재실행하는 등의 적절한 처리를 컨테이너 내의 프로세스가 담당해야 한다. 결과적으로 컨테이너 오케스트레이션 소프트웨어의 이점을 충분히 활용하지 못하는 것이다.

#### 파드의 네트워크

파드 내의 컨테이너들은 하나의 네트워크 인터페이스를 공유한다. 즉, 같은 파드 내의 웹 애플리케이션 컨테이너와 데이터베이스 컨테이너는 서로를 `localhost`로 참조할 수 있다. 또한 포트 공간도 공유하기 때문에 같은 포트를 사용하면 충돌이 발생한다

또한 쿠버네티스 클러스터 내의 모든 파드는 단일 플랫 네트워크로 구성된다. 파드 사이에 별도의 NAT 게이트웨이를 거치지 않기 때문에 다른 파드의 IP로 직접 접근이 가능하다.

#### 서비스 디스커버리

포드는 언제든 사라질 수 있다. 오류가 발생해서일 수도 있고, 새로운 상태를 적용하기 위해 기존의 파드를 종료시킬 수도 있다. 포드가 새로 생성될 때마다 레플리케이션 컨트롤러가 파드를 원하는 상태(파드의 구성, 복제본 등)로 유지해주지만 그 과정에서 파드의 IP는 바뀐다. 때문에 네트워크상에서 수시로 IP가 변하는 파드에 접근하기 위해서는 실행중인 파드의 IP를 기억하고 외부 요청을 해당 파드로 전달해주는 역할일 필요한데, 이것이 서비스이다.

#### 파드 실행하기

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  containers:
    - image: myuser/mycontainerimage
      name: mycontainer
      # 노출하는 포트, 기술하지 않아도 접근 가능하지만 명시해주는 것이 좋다
      ports:
        - containerPort: 8080
          protocol: TcP
```

```
kubectl create -f manifest.yml
```

